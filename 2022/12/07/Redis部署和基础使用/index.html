<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico"><link rel="icon" href="/img/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content=""><meta name="keywords" content="hexo,theme,fluid,linux,ops,运维,分享"><meta name="description" content="Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL"><meta property="og:type" content="article"><meta property="og:title" content="Redis部署和基础使用"><meta property="og:url" content="https://hugo.itshare.work/2022/12/07/Redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/index.html"><meta property="og:site_name" content="Cookie Blog"><meta property="og:description" content="Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670419301827.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670419331717.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670419470181.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670419490780.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670507070884.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853239934.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853325839.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853341364.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853373976.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853388030.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853405541.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853437912.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853466251.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853480093.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853532980.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1670853557144.png"><meta property="article:published_time" content="2022-12-07T13:16:33.000Z"><meta property="article:modified_time" content="2023-03-03T10:18:52.238Z"><meta property="article:tag" content="Linux从入门到放弃"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://hugo.itshare.work/image.assets/1670419301827.png"><title>Redis部署和基础使用 - Cookie Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/tbdzj.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"hugo.itshare.work",root:"/",version:"1.9.3",typing:{enable:!1,typeSpeed:70,cursorChar:" ",loop:!0,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"text"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"hQDROocUhxVs3CipuQjO33sY-gzGzoHsz",app_key:"CHcmi9bz6KRRaChFJVSY14g1",server_url:"https://hqdroocu.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Cookie</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">Redis部署和基础使用</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-12-07 21:16" pubdate>2022年12月7日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 21k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 173 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Redis部署和基础使用</h1><div class="markdown-body"><h1 id="Redis基础"><a href="#Redis基础" class="headerlink" title="Redis基础"></a>Redis基础</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Redis (Remote Dictionary Server远程字典服务)是一个遵循BSD MIT开源协议的高性能的NoSQL.Redis基于ANSI C语言语言)编写的key-value数据库,是意大利的Salvatore Sanfilippo在2009年发布，从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal公司赞助。目前国内外使用的公司众多,比如:阿里,腾讯,百度,京东,新浪微博,GitHub,Twitter 等Redis的出现，很大程度补偿了memcached这类key&#x2F;value存储的不足，在部分场合可以对关系数据库起到很好的补充作用。它提供了Java，C&#x2F;C++，Go, C#，PHP，JavaScript，Perl，Object-C，Python，Ruby，Erlang等客户端<br>DB-Engine月度排行榜Redis在键值型存储类的数据库长期居于首位,远远高于第二位的memcached</p><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>速度快: 10W QPS,基于内存,C语言实现</li><li>单线程</li><li>持久化</li><li>支持多种数据结构</li><li>支持多种编程语言</li><li>功能丰富: 支持Lua脚本,发布订阅,事务,pipeline等功能</li><li>简单: 代码短小精悍(单机核心代码只有23000行左右),单线程开发容易,不依赖外部库,使用简单</li><li>主从复制</li><li>支持高可用和分布式</li></ul><h2 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h2><p>Redis 6.0版本前一直是单线程方式处理用户的请求</p><p><img src="/../image.assets/1670419301827.png" srcset="/img/loading.gif" lazyload alt="1670419301827"></p><p>单线程为何如此快?</p><ul><li>纯内存</li><li>非阻塞避免线程切换和竞态消耗</li></ul><p><img src="/../image.assets/1670419331717.png" srcset="/img/loading.gif" lazyload alt="1670419331717"></p><p>注意事项</p><ul><li>一次只运行一条命令</li><li>避免执行长(慢)命令:keys *, flushall, flushdb, slow lua script, mutil&#x2F;exec, operate bigvalue(collection)</li><li>其实不是单线程: 早期版本是单进程单线程,3.0 版本后实际还有其它的线程, 实现特定功能,如: fysnc file descriptor,close file descriptor</li></ul><h2 id="常见应用场景"><a href="#常见应用场景" class="headerlink" title="常见应用场景"></a>常见应用场景</h2><ul><li>缓存：缓存RDBMS中数据,比如网站的查询结果、商品信息、微博、新闻、消息</li><li>Session 共享：实现Web集群中的多服务器间的session共享</li><li>计数器：商品访问排行榜、浏览数、粉丝数、关注、点赞、评论等和次数相关的数值统计场景</li><li>社交：朋友圈、共同好友、可能认识他们等</li><li>地理位置: 基于地理信息系统GIS（Geographic Information System)实现摇一摇、附近的人、外卖等功能</li><li>消息队列：ELK等日志系统缓存、业务的订阅&#x2F;发布系统</li></ul><h2 id="缓存的实现流程"><a href="#缓存的实现流程" class="headerlink" title="缓存的实现流程"></a>缓存的实现流程</h2><p>数据更新操作流程：</p><p><img src="/../image.assets/1670419470181.png" srcset="/img/loading.gif" lazyload alt="1670419470181"></p><p>数据读操作流程：</p><p><img src="/../image.assets/1670419490780.png" srcset="/img/loading.gif" lazyload alt="1670419490780"></p><h1 id="Redis安装及连接"><a href="#Redis安装及连接" class="headerlink" title="Redis安装及连接"></a>Redis安装及连接</h1><p>官网下载地址</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">http://download.redis.io/releases/<br></code></pre></td></tr></table></figure><h2 id="yum安装"><a href="#yum安装" class="headerlink" title="yum安装"></a>yum安装</h2><p>查看yum库redis版本</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">yum info redis   或者  yum info redis<br></code></pre></td></tr></table></figure><p>yum 安装 redis</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs text">yum install -y redis<br># 启动<br>systemctl enable --now redis<br><br># 连接<br>[root@centos8-backup www]# redis-cli<br>127.0.0.1:6379&gt; <br><br># 查看信息<br>127.0.0.1:6379&gt; info<br># Server<br>redis_version:5.0.3<br>redis_git_sha1:00000000<br>redis_git_dirty:0<br>redis_build_id:9529b692c0384fb7<br>redis_mode:standalone<br>os:Linux 4.18.0-348.7.1.el8_5.x86_64 x86_64<br>arch_bits:64<br>multiplexing_api:epoll<br>......<br>......<br>......<br></code></pre></td></tr></table></figure><h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><ul><li>Redis源码包下载地址</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">http://download.redis.io/releases/<br></code></pre></td></tr></table></figure><ul><li>下载源码包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# wget http://download.redis.io/releases/redis-6.2.6.tar.gz<br>[root@centos7-master ~]# tar xf redis-6.2.6.tar.gz<br></code></pre></td></tr></table></figure><ul><li>安装依赖</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text"># centos<br>[root@centos7-master ~]# yum -y install gcc jemalloc-devel systemd-devel<br># ubuntu<br>apt -y install make gcc libjemalloc-dev libsystemd-dev<br></code></pre></td></tr></table></figure><ul><li>编译安装</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# cd redis-6.2.6<br>#如果支持systemd,需要执行下面<br>[root@centos7-master redis-6.2.6]# make -j 2 USE_SYSTEMD=yes PREFIX=/usr/local/src/redis  install<br><br># 配置环境变量<br>[root@centos7-master ~]# echo &#x27;PATH=/usr/local/src/redis/bin:$PATH&#x27; &gt; /etc/profile.d/redis.sh<br>[root@centos7-master ~]# <br>[root@centos7-master ~]# . /etc/profile.d/redis.sh<br>[root@centos7-master ~]# <br><br>#准备相关目录和配置文件<br>#创建配置文件、日志、数据等目录<br>[root@centos7-master redis]# mkdir /usr/local/src/redis/&#123;etc,log,data,run&#125;<br>[root@centos7-master redis-6.2.6]# cp redis.conf /usr/local/src/redis/etc/<br></code></pre></td></tr></table></figure><ul><li>修改配置文件</li></ul><p>logfile “&#x2F;usr&#x2F;local&#x2F;src&#x2F;redis&#x2F;log&#x2F;redis_6379.log”</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs text"># Specify the log file name. Also the empty string can be used to force<br># Redis to log on the standard output. Note that if you use standard<br># output for logging but daemonize, logs will be sent to /dev/null<br>logfile &quot;/usr/local/src/redis/log/redis_6379.log&quot;<br><br># To enable logging to the system logger, just set &#x27;syslog-enabled&#x27; to yes,<br># and optionally update the other syslog parameters to suit your needs.<br># syslog-enabled no<br><br># Specify the syslog identity.<br># syslog-ident redis<br></code></pre></td></tr></table></figure><p>pidfile &#x2F;usr&#x2F;local&#x2F;src&#x2F;redis&#x2F;run&#x2F;redis_6379.pid</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text"># Note that on modern Linux systems &quot;/run/redis.pid&quot; is more conforming<br># and should be used instead.<br>#pidfile /var/run/redis_6379.pid<br>pidfile /usr/local/src/redis/run/redis_6379.pid<br><br># Specify the server verbosity level.<br># This can be one of:<br># debug (a lot of information, useful for development/testing)<br># verbose (many rarely useful info, but not a mess like the debug level)<br># notice (moderately verbose, what you want in production probably)<br># warning (only very important / critical messages are logged)<br>loglevel notice<br></code></pre></td></tr></table></figure><p>dir “&#x2F;usr&#x2F;local&#x2F;src&#x2F;redis&#x2F;data&#x2F;6379”</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text"># Note that you must specify a directory here, not a file name.<br>dir &quot;/usr/local/src/redis/data/6379&quot;<br><br>################################# REPLICATION #################################<br><br># Master-Replica replication. Use replicaof to make a Redis instance a copy of<br># another Redis server. A few things to understand ASAP about Redis replication.<br></code></pre></td></tr></table></figure><p>dbfilename ‘dump.rdb’</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text"># sanitize-dump-payload no<br><br># The filename where to dump the DB<br>dbfilename &#x27;dump.rdb&#x27;<br></code></pre></td></tr></table></figure><ul><li>前台启动redis</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf <br>51487:C 07 Dec 2022 22:27:26.620 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo<br>51487:C 07 Dec 2022 22:27:26.620 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51487, just started<br>51487:C 07 Dec 2022 22:27:26.620 # Configuration loaded<br>51487:M 07 Dec 2022 22:27:26.620 * Increased maximum number of open files to 10032 (it was originally set to 1024).<br>51487:M 07 Dec 2022 22:27:26.620 * monotonic clock: POSIX clock_gettime<br>                _._                                                  <br>           _.-``__ &#x27;&#x27;-._                                             <br>      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 6.2.6 (00000000/0) 64 bit<br>  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._                                  <br> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode<br> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379<br> |    `-._   `._    /     _.-&#x27;    |     PID: 51487<br>  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;                                   <br> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  <br> |    `-._`-._        _.-&#x27;_.-&#x27;    |           https://redis.io       <br>  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   <br> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  <br> |    `-._`-._        _.-&#x27;_.-&#x27;    |                                  <br>  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   <br>      `-._    `-.__.-&#x27;    _.-&#x27;                                       <br>          `-._        _.-&#x27;                                           <br>              `-.__.-&#x27;                                               <br><br>51487:M 07 Dec 2022 22:27:26.621 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.<br>51487:M 07 Dec 2022 22:27:26.621 # Server initialized<br>51487:M 07 Dec 2022 22:27:26.621 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.<br>51487:M 07 Dec 2022 22:27:26.621 * Ready to accept connections<br><br></code></pre></td></tr></table></figure><ul><li>帮助</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# redis-server -h<br>Usage: ./redis-server [/path/to/redis.conf] [options] [-]<br>       ./redis-server - (read config from stdin)<br>       ./redis-server -v or --version<br>       ./redis-server -h or --help<br>       ./redis-server --test-memory &lt;megabytes&gt;<br><br>Examples:<br>       ./redis-server (run the server with default conf)<br>       ./redis-server /etc/redis/6379.conf<br>       ./redis-server --port 7777<br>       ./redis-server --port 7777 --replicaof 127.0.0.1 8888<br>       ./redis-server /etc/myredis.conf --loglevel verbose -<br>       ./redis-server /etc/myredis.conf --loglevel verbose<br><br>Sentinel mode:<br>       ./redis-server /etc/sentinel.conf --sentinel<br>[root@centos7-master ~]# <br></code></pre></td></tr></table></figure><ul><li>消除启动时的三个Warning提示信息(可选)</li></ul><p>Tcp backlog</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">WARNING: The TCP backlog setting of 511 cannot be enforced because<br>/proc/sys/net/core/somaxconn is set to the lower value of 128.<br></code></pre></td></tr></table></figure><p>Tcp backlog 是指TCP的第三次握手服务器端收到客户端 ack确认号之后到服务器用Accept函数处理请求前的队列长度，即全连接队列</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">#vim /etc/sysctl.conf<br>net.core.somaxconn = 511<br>#sysctl -p<br></code></pre></td></tr></table></figure><p>overcommit_memory</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">WARNING overcommit_memory is set to 0! Background save may fail under low memory<br>condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf<br>and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to<br>take effect.<br></code></pre></td></tr></table></figure><p>内核参数说明</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">内核参数overcommit_memory 实现内存分配策略,可选值有三个：0、1、2<br>0 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则内存<br>申请失败，并把错误返回给应用进程<br>1 表示内核允许分配所有的物理内存，而不管当前的内存状态如何<br>2 表示内核允许分配超过所有物理内存和交换空间总和的内存<br></code></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">#vim /etc/sysctl.conf<br>vm.overcommit_memory = 1<br>#sysctl -p<br></code></pre></td></tr></table></figure><p>transparent hugepage</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">WARNING you have Transparent Huge Pages (THP) support enabled in your kernel.<br>This will create latency and memory usage issues with Redis. To fix this issue<br>run the command &#x27;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#x27; as<br>root, and add it to your /etc/rc.local in order to retain the setting after a<br>reboot. Redis must be restarted after THP is disabled.<br>警告：您在内核中启用了透明大页面（THP,不同于一般4k内存页,而为2M）支持。 这将在Redis中造成延迟<br>和内存使用问题。 要解决此问题，请以root 用户身份运行命令“echo never&gt;<br>/sys/kernel/mm/transparent_hugepage/enabled”，并将其添加到您的/etc/rc.local中，以便在<br>重启后保留设置。禁用THP后，必须重新启动Redis。<br></code></pre></td></tr></table></figure><p>注意：ubuntu20.04, Rocky8&#x2F;CentOS8 默认为 never，所以此值无需优化</p><p>验证是否消除warning</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf <br>51540:C 07 Dec 2022 22:38:45.196 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo<br>51540:C 07 Dec 2022 22:38:45.196 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51540, just started<br>51540:C 07 Dec 2022 22:38:45.196 # Configuration loaded<br>51540:M 07 Dec 2022 22:38:45.197 * Increased maximum number of open files to 10032 (it was originally set to 1024).<br>51540:M 07 Dec 2022 22:38:45.197 * monotonic clock: POSIX clock_gettime<br>                _._                                                  <br>           _.-``__ &#x27;&#x27;-._                                             <br>      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 6.2.6 (00000000/0) 64 bit<br>  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._                                  <br> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode<br> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379<br> |    `-._   `._    /     _.-&#x27;    |     PID: 51540<br>  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;                                   <br> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  <br> |    `-._`-._        _.-&#x27;_.-&#x27;    |           https://redis.io       <br>  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   <br> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  <br> |    `-._`-._        _.-&#x27;_.-&#x27;    |                                  <br>  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   <br>      `-._    `-.__.-&#x27;    _.-&#x27;                                       <br>          `-._        _.-&#x27;                                           <br>              `-.__.-&#x27;                                               <br><br>51540:M 07 Dec 2022 22:38:45.197 # Server initialized<br>51540:M 07 Dec 2022 22:38:45.198 * Loading RDB produced by version 6.2.6<br>51540:M 07 Dec 2022 22:38:45.198 * RDB age 2 seconds<br>51540:M 07 Dec 2022 22:38:45.198 * RDB memory usage when created 0.77 Mb<br>51540:M 07 Dec 2022 22:38:45.198 # Done loading RDB, keys loaded: 0, keys expired: 0.<br>51540:M 07 Dec 2022 22:38:45.198 * DB loaded from disk: 0.000 seconds<br>51540:M 07 Dec 2022 22:38:45.198 * Ready to accept connections<br></code></pre></td></tr></table></figure><ul><li>创建 Redis 用户和设置数据目录权限</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# useradd -r -s /sbin/nologin redis<br>[root@centos7-master ~]# chown -R  redis.redis /usr/local/src/redis/<br>[root@centos7-master ~]# <br></code></pre></td></tr></table></figure><ul><li>创建 Redis 服务 Service 文件</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master ~]# vim /lib/systemd/system/redis.service<br><br>[Unit]<br>Description=Redis persistent key-value database<br>After=network.target<br>[Service]<br>ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis.conf --supervised systemd<br>ExecStop=/bin/kill -s QUIT $MAINPID<br>Type=notify <br>User=redis<br>Group=redis<br>RuntimeDirectory=redis<br>RuntimeDirectoryMode=0755<br>LimitNOFILE=1000000 <br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><ul><li>Redis 通过Service方式启动</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">systemctl daemon-reload<br>systemctl restart redis<br>systemctl status redis<br></code></pre></td></tr></table></figure><h2 id="Redis多实例"><a href="#Redis多实例" class="headerlink" title="Redis多实例"></a>Redis多实例</h2><p>基于源码编译安装的前提下实现redis的多实例</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs text"># 进入/usr/local/src/redis/etc<br>[root@centos7-master ~]# cd /usr/local/src/redis/etc/<br>[root@centos7-master etc]# <br><br># 修改配置文件，使用6380,6381端口启动实例<br>[root@centos7-master etc]# sed &#x27;s/6379/6380/&#x27; redis.conf &gt; redis6380.conf<br>[root@centos7-master etc]# sed &#x27;s/6379/6380/&#x27; redis.conf &gt; redis6381.conf<br><br># 修改所属组<br>[root@centos7-master etc]# chown -R redis.redis *<br><br># 修改启动文件<br>[root@centos7-master etc]# cp /lib/systemd/system/redis.service /lib/systemd/system/redis6380.service <br>[root@centos7-master etc]# <br><br>[root@centos7-master etc]# vim /lib/systemd/system/redis6380.service <br>[Unit]<br>Description=Redis persistent key-value database<br>After=network.target<br>[Service]<br>ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis6380.conf --supervised systemd<br>ExecStop=/bin/kill -s QUIT $MAINPID<br>Type=notify<br>User=redis<br>Group=redis<br>RuntimeDirectory=redis<br>RuntimeDirectoryMode=0755<br>LimitNOFILE=1000000<br>[Install]<br>WantedBy=multi-user.target<br><br># 使用相同方法创建/lib/systemd/system/redis6381.service文件并修改内容<br><br># 启动实例<br>[root@centos7-master etc]# systemctl status redis.service<br>[root@centos7-master etc]# systemctl status redis6380.service<br>[root@centos7-master etc]# systemctl status redis6381.service<br><br># 查看6379 6380 6381 端口是否启用<br></code></pre></td></tr></table></figure><p><img src="/../image.assets/1670507070884.png" srcset="/img/loading.gif" lazyload alt="1670507070884"></p><ul><li>连接测试</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@centos7-master etc]# redis-cli -p 6379<br>[root@centos7-master etc]# redis-cli -p 6380<br>[root@centos7-master etc]# redis-cli -p 6381<br></code></pre></td></tr></table></figure><h1 id="Redis-配置管理"><a href="#Redis-配置管理" class="headerlink" title="Redis 配置管理"></a>Redis 配置管理</h1><h2 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">bind 0.0.0.0 #指定监听地址，支持用空格隔开的多个监听IP<br>protected-mode yes #redis3.2之后加入的新特性，在没有设置bind IP和密码的时候,redis只允许访<br>问127.0.0.1:6379，可以远程连接，但当访问将提示警告信息并拒绝远程访问<br>port 6379 #监听端口,默认6379/tcp<br>tcp-backlog 511 #三次握手的时候server端收到client ack确认号之后的队列值，即全连接队列长度<br>timeout 0 #客户端和Redis服务端的连接超时时间，默认是0，表示永不超时<br>tcp-keepalive 300 #tcp 会话保持时间300s<br>daemonize no #默认no,即直接运行redis-server程序时,不作为守护进程运行，而是以前台方式运行，<br>如果想在后台运行需改成yes,当redis作为守护进程运行的时候，它会写一个 pid 到<br>/var/run/redis.pid 文件<br>supervised no #和OS相关参数，可设置通过upstart和systemd管理Redis守护进程，centos7后都使<br>用systemd<br>pidfile /var/run/redis_6379.pid #pid文件路径,可以修改<br>为/apps/redis/run/redis_6379.pid<br>loglevel notice #日志级别<br>logfile &quot;/path/redis.log&quot; #日志路径,示例:logfile &quot;/apps/redis/log/redis_6379.log&quot;<br>databases 16 #设置数据库数量，默认：0-15，共16个库<br>always-show-logo yes #在启动redis 时是否显示或在日志中记录记录redis的logo<br></code></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs text">save 900 1 #在900秒内有1个key内容发生更改,就执行快照机制<br>save 300 10 #在300秒内有10个key内容发生更改,就执行快照机制<br>save 60 10000 #60秒内如果有10000个key以上的变化，就自动快照备份<br>stop-writes-on-bgsave-error yes #默认为yes时,可能会因空间满等原因快照无法保存出错时，会禁<br>止redis写入操作，生产建议为no<br>#此项只针对配置文件中的自动save有效<br>rdbcompression yes #持久化到RDB文件时，是否压缩，&quot;yes&quot;为压缩，&quot;no&quot;则反之<br>rdbchecksum yes #是否对备份文件开启RC64校验，默认是开启<br>dbfilename dump.rdb #快照文件名<br>dir ./ #快照文件保存路径，示例：dir &quot;/apps/redis/data&quot;<br>#主从复制相关<br># replicaof &lt;masterip&gt; &lt;masterport&gt; #指定复制的master主机地址和端口，5.0版之前的指令为<br>slaveof<br># masterauth &lt;master-password&gt; #指定复制的master主机的密码<br>replica-serve-stale-data yes #当从库同主库失去连接或者复制正在进行，从机库有两种运行方式：<br>1、设置为yes(默认设置)，从库会继续响应客户端的读请求，此为建议值<br>2、设置为no，除去特定命令外的任何请求都会返回一个错误&quot;SYNC with master in progress&quot;。<br>replica-read-only yes #是否设置从库只读，建议值为yes,否则主库同步从库时可能会覆盖数据，造成<br>数据丢失<br>repl-diskless-sync no #是否使用socket方式复制数据(无盘同步)，新slave第一次连接master时需<br>要做数据的全量同步，redis server就要从内存dump出新的RDB文件，然后从master传到slave，有两种<br>方式把RDB文件传输给客户端：<br>1、基于硬盘（disk-backed）：为no时，master创建一个新进程dump生成RDB磁盘文件，RDB完成之后由<br>父进程（即主进程）将RDB文件发送给slaves，此为默认值<br>2、基于socket（diskless）：master创建一个新进程直接dump RDB至slave的网络socket，不经过主<br>进程和硬盘<br>#推荐使用基于硬盘（为no），是因为RDB文件创建后，可以同时传输给更多的slave，但是基于socket(为<br>yes)， 新slave连接到master之后得逐个同步数据。只有当磁盘I/O较慢且网络较快时，可用<br>diskless(yes),否则一般建议使用磁盘(no)<br>repl-diskless-sync-delay 5 #diskless时复制的服务器等待的延迟时间，设置0为关闭，在延迟时间<br>内到达的客户端，会一起通过diskless方式同步数据，但是一旦复制开始，master节点不会再接收新slave<br>的复制请求，直到下一次同步开始才再接收新请求。即无法为延迟时间后到达的新副本提供服务，新副本将排<br>队等待下一次RDB传输，因此服务器会等待一段时间才能让更多副本到达。推荐值：30-60<br>repl-ping-replica-period 10 #slave根据master指定的时间进行周期性的PING master,用于监测<br>master状态,默认10s<br>repl-timeout 60 #复制连接的超时时间，需要大于repl-ping-slave-period，否则会经常报超时<br>repl-disable-tcp-nodelay no #是否在slave套接字发送SYNC之后禁用 TCP_NODELAY，如果选<br>择&quot;yes&quot;，Redis将合并多个报文为一个大的报文，从而使用更少数量的包向slaves发送数据，但是将使数据<br>传输到slave上有延迟，Linux内核的默认配置会达到40毫秒，如果 &quot;no&quot; ，数据传输到slave的延迟将会<br>减少，但要使用更多的带宽<br>repl-backlog-size 512mb #复制缓冲区内存大小，当slave断开连接一段时间后，该缓冲区会累积复制<br>副本数据，因此当slave 重新连接时，通常不需要完全重新同步，只需传递在副本中的断开连接后没有同步的<br>部分数据即可。只有在至少有一个slave连接之后才分配此内存空间,建议建立主从时此值要调大一些或在低峰<br>期配置,否则会导致同步到slave失败<br></code></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs text">repl-backlog-ttl 3600 #多长时间内master没有slave连接，就清空backlog缓冲区<br>replica-priority 100 #当master不可用，哨兵Sentinel会根据slave的优先级选举一个master，此<br>值最低的slave会优先当选master，而配置成0，永远不会被选举，一般多个slave都设为一样的值，让其自<br>动选择<br>#min-replicas-to-write 3 #至少有3个可连接的slave，mater才接受写操作<br>#min-replicas-max-lag 10 #和上面至少3个slave的ping延迟不能超过10秒，否则master也将停止<br>写操作<br>requirepass foobared #设置redis连接密码，之后需要AUTH pass,如果有特殊符号，用&quot; &quot;引起来,生<br>产建议设置<br>rename-command #重命名一些高危命令，示例：rename-command FLUSHALL &quot;&quot; 禁用命令<br>#示例: rename-command del magedu<br>maxclients 10000 #Redis最大连接客户端<br>maxmemory &lt;bytes&gt; #redis使用的最大内存，单位为bytes字节，0为不限制，建议设为物理内存一半，<br>8G内存的计算方式8(G)*1024(MB)1024(KB)*1024(Kbyte)，需要注意的是缓冲区是不计算在maxmemory<br>内,生产中如果不设置此项,可能会导致OOM<br>#maxmemory-policy noeviction 此为默认值<br># MAXMEMORY POLICY：当达到最大内存时，Redis 将如何选择要删除的内容。您可以从以下行为中选择一<br>种：<br>#<br># volatile-lru -&gt; Evict 使用近似 LRU，只有设置了过期时间的键。<br># allkeys-lru -&gt; 使用近似 LRU 驱逐任何键。<br># volatile-lfu -&gt; 使用近似 LFU 驱逐，只有设置了过期时间的键。<br># allkeys-lfu -&gt; 使用近似 LFU 驱逐任何键。<br># volatile-random -&gt; 删除设置了过期时间的随机密钥。<br># allkeys-random -&gt; 删除一个随机密钥，任何密钥。<br># volatile-ttl -&gt; 删除过期时间最近的key（次TTL）<br># noeviction -&gt; 不要驱逐任何东西，只是在写操作时返回一个错误。<br>#<br># LRU 表示最近最少使用<br># LFU 表示最不常用<br>#<br># LRU、LFU 和 volatile-ttl 都是使用近似随机算法实现的。<br>#<br># 注意：使用上述任何一种策略，当没有合适的键用于驱逐时，Redis 将在需要更多内存的写操作时返回错<br>误。这些通常是创建新密钥、添加数据或修改现有密钥的命令。一些示例是：SET、INCR、HSET、LPUSH、<br>SUNIONSTORE、SORT（由于 STORE 参数）和 EXEC（如果事务包括任何需要内存的命令）。<br>#MAXMEMORY POLICY：当达到最大内存时，Redis 将如何选择要删除的内容。可以从下面行为中进行选<br>择：<br># volatile-lru -&gt; 在具有过期集的键中使用近似 LRU 驱逐。<br># allkeys-lru -&gt; 使用近似 LRU 驱逐任何键。<br># volatile-lfu -&gt; 在具有过期集的键中使用近似 LFU 驱逐。<br># allkeys-lfu -&gt; 使用近似 LFU 驱逐任何键。<br># volatile-random -&gt; 从具有过期设置的密钥中删除一个随机密钥。<br># allkeys-random -&gt; 删除一个随机密钥，任何密钥。<br># volatile-ttl -&gt; 删除过期时间最近的key（次TTL）<br># noeviction -&gt; 不要驱逐任何东西，只是在写操作时返回一个错误。<br>#<br># LRU 表示最近最少使用<br></code></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs text"># LFU 表示最不常用<br>#<br># LRU、LFU 和 volatile-ttl 均使用近似实现随机算法。<br>#<br># 注意：使用上述任何一种策略，Redis 都会在写入时返回错误操作，当没有合适的键用于驱逐时。<br>appendonly no #是否开启AOF日志记录，默认redis使用的是rdb方式持久化，这种方式在许多应用中已经<br>足够用了，但是redis如果中途宕机，会导致可能有几分钟的数据丢失(取决于dump数据的间隔时间)，根据<br>save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，Redis会<br>把每次写入的数据在接收后都写入 appendonly.aof 文件，每次启动时Redis都会先把这个文件的数据读入<br>内存里，先忽略RDB文件。默认不启用此功能<br>appendfilename &quot;appendonly.aof&quot; #文本文件AOF的文件名，存放在dir指令指定的目录中<br>appendfsync everysec #aof持久化策略的配置<br>#no表示由操作系统保证数据同步到磁盘,Linux的默认fsync策略是30秒，最多会丢失30s的数据<br>#always表示每次写入都执行fsync，以保证数据同步到磁盘,安全性高,性能较差<br>#everysec表示每秒执行一次fsync，可能会导致丢失这1s数据,此为默认值,也生产建议值<br>#同时在执行bgrewriteaof操作和主进程写aof文件的操作，两者都会操作磁盘，而bgrewriteaof往往会<br>涉及大量磁盘操作，这样就会造成主进程在写aof文件的时候出现阻塞的情形,以下参数实现控制<br>no-appendfsync-on-rewrite no #在aof rewrite期间,是否对aof新记录的append暂缓使用文件同步<br>策略,主要考虑磁盘IO开支和请求阻塞时间。<br>#默认为no,表示&quot;不暂缓&quot;,新的aof记录仍然会被立即同步到磁盘，是最安全的方式，不会丢失数据，但是要<br>忍受阻塞的问题<br>#为yes,相当于将appendfsync设置为no，这说明并没有执行磁盘操作，只是写入了缓冲区，因此这样并不<br>会造成阻塞（因为没有竞争磁盘），但是如果这个时候redis挂掉，就会丢失数据。丢失多少数据呢？Linux<br>的默认fsync策略是30秒，最多会丢失30s的数据,但由于yes性能较好而且会避免出现阻塞因此比较推荐<br>#rewrite 即对aof文件进行整理,将空闲空间回收,从而可以减少恢复数据时间<br>auto-aof-rewrite-percentage 100 #当Aof log增长超过指定百分比例时，重写AOF文件，设置为0表<br>示不自动重写Aof日志，重写是为了使aof体积保持最小，但是还可以确保保存最完整的数据<br>auto-aof-rewrite-min-size 64mb #触发aof rewrite的最小文件大小<br>aof-load-truncated yes #是否加载由于某些原因导致的末尾异常的AOF文件(主进程被kill/断电等)，<br>建议yes<br>aof-use-rdb-preamble no #redis4.0新增RDB-AOF混合持久化格式，在开启了这个功能之后，AOF重<br>写产生的文件将同时包含RDB格式的内容和AOF格式的内容，其中RDB格式的内容用于记录已有的数据，而AOF<br>格式的内容则用于记录最近发生了变化的数据，这样Redis就可以同时兼有RDB持久化和AOF持久化的优点（既<br>能够快速地生成重写文件，也能够在出现问题时，快速地载入数据）,默认为no,即不启用此功能<br>lua-time-limit 5000 #lua脚本的最大执行时间，单位为毫秒<br>cluster-enabled yes #是否开启集群模式，默认不开启,即单机模式<br>cluster-config-file nodes-6379.conf #由node节点自动生成的集群配置文件名称<br>cluster-node-timeout 15000 #集群中node节点连接超时时间，单位ms,超过此时间，会踢出集群<br>cluster-replica-validity-factor 10 #单位为次,在执行故障转移的时候可能有些节点和master断<br>开一段时间导致数据比较旧，这些节点就不适用于选举为master，超过这个时间的就不会被进行故障转移,不<br>能当选master，计算公式：(node-timeout * replica-validity-factor) + repl-ping-<br>replica-period<br></code></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">cluster-migration-barrier 1 #集群迁移屏障，一个主节点至少拥有1个正常工作的从节点，即如果主<br>节点的slave节点故障后会将多余的从节点分配到当前主节点成为其新的从节点。<br>cluster-require-full-coverage yes #集群请求槽位全部覆盖，如果一个主库宕机且没有备库就会出<br>现集群槽位不全，那么yes时redis集群槽位验证不全,就不再对外提供服务(对key赋值时,会出现<br>CLUSTERDOWN The cluster is down的提示,cluster_state:fail,但ping 仍PONG)，而no则可以<br>继续使用,但是会出现查询数据查不到的情况(因为有数据丢失)。生产建议为no<br>cluster-replica-no-failover no #如果为yes,此选项阻止在主服务器发生故障时尝试对其主服务器进<br>行故障转移。 但是，主服务器仍然可以执行手动强制故障转移，一般为no<br>#Slow log 是 Redis 用来记录超过指定执行时间的日志系统，执行时间不包括与客户端交谈，发送回复等<br>I/O操作，而是实际执行命令所需的时间（在该阶段线程被阻塞并且不能同时为其它请求提供服务）,由于<br>slow log 保存在内存里面，读写速度非常快，因此可放心地使用，不必担心因为开启 slow log 而影响<br>Redis 的速度<br>slowlog-log-slower-than 10000 #以微秒为单位的慢日志记录，为负数会禁用慢日志，为0会记录每个<br>命令操作。默认值为10ms,一般一条命令执行都在微秒级,生产建议设为1ms-10ms之间<br>slowlog-max-len 128 #最多记录多少条慢日志的保存队列长度，达到此长度后，记录新命令会将最旧的命<br>令从命令队列中删除，以此滚动删除,即,先进先出,队列固定长度,默认128,值偏小,生产建议设为1000以上<br></code></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ysocean/p/9074787.html">Redis的配置文件介绍</a></p><h2 id="config-命令实现动态修改配置"><a href="#config-命令实现动态修改配置" class="headerlink" title="config 命令实现动态修改配置"></a>config 命令实现动态修改配置</h2><p>config 命令用于查看当前redis配置、以及不重启redis服务实现动态更改redis配置等<br>注意：不是所有配置都可以动态修改,且此方式无法持久保存</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">CONFIG SET parameter value<br>时间复杂度：O(1)<br>CONFIG SET 命令可以动态地调整 Redis 服务器的配置(configuration)而无须重启。<br>可以使用它修改配置参数，或者改变 Redis 的持久化(Persistence)方式。<br>CONFIG SET 可以修改的配置参数可以使用命令 CONFIG GET * 来列出，所有被 CONFIG SET 修改的配<br>置参数都会立即生效。<br>CONFIG GET parameter<br>时间复杂度： O(N)，其中 N 为命令返回的配置选项数量。<br>CONFIG GET 命令用于取得运行中的 Redis 服务器的配置参数(configuration parameters)，在<br>Redis 2.4 版本中， 有部分参数没有办法用 CONFIG GET 访问，但是在最新的 Redis 2.6 版本中，所<br>有配置参数都已经可以用 CONFIG GET 访问了。<br>CONFIG GET 接受单个参数 parameter 作为搜索关键字，查找所有匹配的配置参数，其中参数和值以“键-<br>值对”(key-value pairs)的方式排列。<br>比如执行 CONFIG GET s* 命令，服务器就会返回所有以 s 开头的配置参数及参数的值：<br></code></pre></td></tr></table></figure><h3 id="设置客户端连接密码"><a href="#设置客户端连接密码" class="headerlink" title="设置客户端连接密码"></a>设置客户端连接密码</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">#设置连接密码<br>127.0.0.1:6379&gt; CONFIG SET requirepass 123456<br>OK<br>#查看连接密码<br>127.0.0.1:6379&gt; CONFIG GET requirepass<br>1) &quot;requirepass&quot;<br>2) &quot;123456&quot;<br></code></pre></td></tr></table></figure><h3 id="获取当前配置"><a href="#获取当前配置" class="headerlink" title="获取当前配置"></a>获取当前配置</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs text">#奇数行为键，偶数行为值<br>127.0.0.1:6379&gt; CONFIG GET *<br>1) &quot;dbfilename&quot;<br>2) &quot;dump.rdb&quot;<br>3) &quot;requirepass&quot;<br>4) &quot;&quot;<br>5) &quot;masterauth&quot;<br>6) &quot;&quot;<br>7) &quot;cluster-announce-ip&quot;<br>8) &quot;&quot;<br>9) &quot;unixsocket&quot;<br>10) &quot;&quot;<br>11) &quot;logfile&quot;<br>12) &quot;/var/log/redis/redis.log&quot;<br>13) &quot;pidfile&quot;<br>14) &quot;/var/run/redis_6379.pid&quot;<br>15) &quot;slave-announce-ip&quot;<br>16) &quot;&quot;<br>17) &quot;replica-announce-ip&quot;<br>18) &quot;&quot;<br>19) &quot;maxmemory&quot;<br>20) &quot;0&quot;<br>......<br>#查看bind<br>127.0.0.1:6379&gt; CONFIG GET bind<br>1) &quot;bind&quot;<br>2) &quot;0.0.0.0&quot;<br>#Redis5.0有些设置无法修改,Redis6.2.6版本支持修改bind<br>127.0.0.1:6379&gt; CONFIG SET bind 127.0.0.1<br>(error) ERR Unsupported CONFIG parameter: bind<br></code></pre></td></tr></table></figure><h3 id="设置Redis使用的最大内存量"><a href="#设置Redis使用的最大内存量" class="headerlink" title="设置Redis使用的最大内存量"></a>设置Redis使用的最大内存量</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">127.0.0.1:6379&gt; CONFIG SET maxmemory 8589934592<br>OK<br>127.0.0.1:6379&gt; CONFIG GET maxmemory<br>1) &quot;maxmemory&quot;<br>2) &quot;8589934592&quot;<br></code></pre></td></tr></table></figure><h3 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h3><p>范例：SLOW LOG</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs text">vim /etc/redis.conf<br>slowlog-log-slower-than 1 #指定超过1us即为慢的指令，默认值为10000us<br>slowlog-max-len 1024 #指定只保存最近的1024条慢记录，默认值为128<br>127.0.0.1:6379&gt; SLOWLOG LEN #查看慢日志的记录条数<br>(integer) 14<br>127.0.0.1:6379&gt; SLOWLOG GET [n] #查看慢日志的n条记录<br>1) 1) (integer) 14<br>2) (integer) 1544690617<br>3) (integer) 4 #第3)行表示每条指令的执行时长<br>4) 1) &quot;slowlog&quot;<br>127.0.0.1:6379&gt; SLOWLOG GET 3<br>1) 1) (integer) 7<br>2) (integer) 1602901545<br>3) (integer) 26<br>4) 1) &quot;SLOWLOG&quot;<br>2) &quot;get&quot;<br>5) &quot;127.0.0.1:38258&quot;<br>6) &quot;&quot;<br>2) 1) (integer) 6<br>2) (integer) 1602901540<br>3) (integer) 22<br>4) 1) &quot;SLOWLOG&quot;<br>2) &quot;get&quot;<br>3) &quot;2&quot;<br>5) &quot;127.0.0.1:38258&quot;<br>6) &quot;&quot;<br>3) 1) (integer) 5<br>2) (integer) 1602901497<br>3) (integer) 22<br>4) 1) &quot;SLOWLOG&quot;<br>2) &quot;GET&quot;<br>5) &quot;127.0.0.1:38258&quot;<br>6) &quot;&quot;<br>127.0.0.1:6379&gt; SLOWLOG RESET #清空慢日志<br>OK<br></code></pre></td></tr></table></figure><h3 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h3><p><img src="/../image.assets/1670853239934.png" srcset="/img/loading.gif" lazyload alt="1670853239934"></p><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>RDB 工作原理</p><p><img src="/../image.assets/1670853325839.png" srcset="/img/loading.gif" lazyload alt="1670853325839"></p><p><img src="/../image.assets/1670853341364.png" srcset="/img/loading.gif" lazyload alt="1670853341364"></p><p><img src="/../image.assets/1670853373976.png" srcset="/img/loading.gif" lazyload alt="1670853373976"></p><p><img src="/../image.assets/1670853388030.png" srcset="/img/loading.gif" lazyload alt="1670853388030"></p><p><img src="/../image.assets/1670853405541.png" srcset="/img/loading.gif" lazyload alt="1670853405541"></p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p><img src="/../image.assets/1670853437912.png" srcset="/img/loading.gif" lazyload alt="1670853437912"></p><p><img src="/../image.assets/1670853466251.png" srcset="/img/loading.gif" lazyload alt="1670853466251"></p><p><img src="/../image.assets/1670853480093.png" srcset="/img/loading.gif" lazyload alt="1670853480093"></p><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p><img src="/../image.assets/1670853532980.png" srcset="/img/loading.gif" lazyload alt="1670853532980"></p><p><img src="/../image.assets/1670853557144.png" srcset="/img/loading.gif" lazyload alt="1670853557144"></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Redis%E5%9F%BA%E7%A1%80/" class="category-chain-item">Redis基础</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Linux%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/">#Linux从入门到放弃</a></div></div><div class="license-box my-3"><div class="license-title"><div>Redis部署和基础使用</div><div>https://hugo.itshare.work/2022/12/07/Redis部署和基础使用/</div></div><div class="license-meta"><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年12月7日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2023年3月3日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/12/13/Redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/" title="Redis集群和高可用"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Redis集群和高可用</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/12/04/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" title="网络文件共享服务"><span class="hidden-mobile">网络文件共享服务</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",(function(){var i=Object.assign({appId:"hQDROocUhxVs3CipuQjO33sY-gzGzoHsz",appKey:"CHcmi9bz6KRRaChFJVSY14g1",path:"window.location.pathname",placeholder:"请在这里书写你想说的话······",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:"",emojiCDN:null,emojiMaps:null,enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><span>由<a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>强力驱动</span> <i class="iconfont icon-love"></i> <span>主题</span> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <span>©2022 - 2023</span></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访问客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">黔ICP备2022006994号-2 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=http://beian.miit.gov.cn/" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>黔公网安备2022006994号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/caidai.js"></script><script src="/js/love.main.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>