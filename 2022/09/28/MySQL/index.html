<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico"><link rel="icon" href="/img/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content=""><meta name="keywords" content="hexo,theme,fluid,linux,ops,运维,分享"><meta name="description" content="MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一"><meta property="og:type" content="article"><meta property="og:title" content="MySQL数据库基础和安装使用"><meta property="og:url" content="https://hugo.itshare.work/2022/09/28/MySQL/index.html"><meta property="og:site_name" content="Cookie Blog"><meta property="og:description" content="MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1668695639684.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1664415600826.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1664415914209.png"><meta property="og:image" content="https://hugo.itshare.work/image.assets/1664459241867.png"><meta property="article:published_time" content="2022-09-28T14:42:41.000Z"><meta property="article:modified_time" content="2023-03-03T10:17:30.438Z"><meta property="article:tag" content="MySQL基础"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://hugo.itshare.work/image.assets/1668695639684.png"><title>MySQL数据库基础和安装使用 - Cookie Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/tbdzj.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"hugo.itshare.work",root:"/",version:"1.9.3",typing:{enable:!1,typeSpeed:70,cursorChar:" ",loop:!0,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"text"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"hQDROocUhxVs3CipuQjO33sY-gzGzoHsz",app_key:"CHcmi9bz6KRRaChFJVSY14g1",server_url:"https://hqdroocu.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Cookie</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">MySQL数据库基础和安装使用</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-09-28 22:42" pubdate>2022年9月28日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 15k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 127 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">MySQL数据库基础和安装使用</h1><div class="markdown-body"><p class="note note-success">MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一</p><span id="more"></span><h1 id="MySQL的特性"><a href="#MySQL的特性" class="headerlink" title="MySQL的特性"></a>MySQL的特性</h1><p><img src="/../image.assets/1668695639684.png" srcset="/img/loading.gif" lazyload alt="1668695639684"></p><h1 id="MySQL安装"><a href="#MySQL安装" class="headerlink" title="MySQL安装"></a>MySQL安装</h1><h2 id="安装方式介绍"><a href="#安装方式介绍" class="headerlink" title="安装方式介绍"></a>安装方式介绍</h2><p>程序包管理器管理的程序包<br>源代码编译安装<br>二进制格式的程序包：展开至特定路径，并经过简单配置后即可使用</p><h3 id="rpm安装"><a href="#rpm安装" class="headerlink" title="rpm安装"></a>rpm安装</h3><p>CentOS 安装光盘<br>项目官方：<a target="_blank" rel="noopener" href="https://downloads.mariadb.org/mariadb/repositories/">https://downloads.mariadb.org/mariadb/repositories/</a><br>国内镜像：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/mariadb/yum/">https://mirrors.tuna.tsinghua.edu.cn/mariadb/yum/</a><br><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/">https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/</a></p><p><strong>范例1：CentOS 7 利用yum源安装MySQL8.0</strong></p><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/repo/yum/">MySQL官网</a></p><ul><li>官网下载rpm包</li></ul><p><img src="/../image.assets/1664415600826.png" srcset="/img/loading.gif" lazyload alt="1664415600826"></p><ul><li>利用rz命令将rpm包上传到主机</li></ul><p><strong>扩展：</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">rz命令yum安装:yum install lrzsz<br></code></pre></td></tr></table></figure><p><img src="/../image.assets/1664415914209.png" srcset="/img/loading.gif" lazyload alt="1664415914209"></p><ul><li>安装rpm包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">root@centos7[~]-&gt;yum install mysql80-community-release-el7-7.noarch.rpm<br></code></pre></td></tr></table></figure><ul><li>安装MySQL</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">root@centos7[~]-&gt;yum install -y mysql-community-server<br></code></pre></td></tr></table></figure><p><strong>范例2：CentOS 7 利用yum源安装MySQL5.7</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">[root@centos7 ~]#tee /etc/yum.repos.d/mysql.repo &lt;&lt;EOF<br>[mysql]<br>name=mysql5.7<br>baseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-5.7-community-el7-<br>x86_64/<br>gpgcheck=0<br>EOF<br>[root@centos7 ~]#yum -y install mysql-community-server<br>[root@centos7 ~]#systemctl enable --now mysqld<br></code></pre></td></tr></table></figure><h3 id="二进制安装"><a href="#二进制安装" class="headerlink" title="二进制安装"></a>二进制安装</h3><p><strong>环境</strong></p><p>系统：rocky8.5</p><p>MySQL版本：mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz</p><p><strong>步骤</strong></p><ul><li>安装相关包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">yum -y install libaio numactl-libs<br></code></pre></td></tr></table></figure><ul><li>准备用户</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">groupadd mysql<br>useradd -r -g mysql -s /bin/false mysql<br></code></pre></td></tr></table></figure><ul><li>下载二进制程序包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TEXT"># -P下载到指定目录<br>wget https://cdn.mysql.com/archives/mysql-8.0/mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz -P /usr/local/  <br><br> ln -s mysql-8.0.28-linux-glibc2.12-x86_64 mysql<br> <br> chown -R root.root /usr/local/mysql/<br></code></pre></td></tr></table></figure><ul><li>准备环境变量</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">echo &#x27;PATH=/usr/local/mysql/bin:$PATH&#x27; &gt; /etc/profile.d/mysql.sh<br>. /etc/profile.d/mysql.sh<br></code></pre></td></tr></table></figure><ul><li>准备配置文件</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">vim /etc/my.cnf<br>[mysqld]<br>datadir=/data/mysql<br>skip_name_resolve=1<br>socket=/data/mysql/mysql.sock<br>log-error=/data/mysql/mysql.log<br>pid-file=/data/mysql/mysql.pid<br>[client]<br>socket=/data/mysql/mysql.sock<br></code></pre></td></tr></table></figure><ul><li>初始化数据库文件并提取root密码</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">mkdir -pv /data/mysql<br>grep password /data/mysql/mysql.log<br></code></pre></td></tr></table></figure><p>生成随机密码</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">mysqld --initialize --user=mysql --datadir=/data/mysql<br></code></pre></td></tr></table></figure><p>生成空密码</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">mysqld --initialize-insecure --user=mysql --datadir=/data/mysql<br></code></pre></td></tr></table></figure><ul><li>准备服务脚本和启动</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">[root@rocky local]# cp /usr/local/mysql/support-files/mysql.server  /etc/init.d/mysqld<br><br>chkconfig --add mysqld<br># 启动服务<br>service mysqld start<br></code></pre></td></tr></table></figure><ul><li>修改口令</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TEXT"># 修改随机密码为指定密码<br>mysqladmin -uroot -p&#x27;9ATjCOB(jIef&#x27; password 123456<br><br>#修改前面生成的空密码为指定密码<br>mysqladmin -uroot password 123456<br></code></pre></td></tr></table></figure><ul><li>测试登录</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">mysql -uroot -p&#x27;123456&#x27;<br></code></pre></td></tr></table></figure><p>注意：登录mysql报如下信息</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">mysql: error while loading shared libraries: libtinfo.so.5: cannot open shared object file: No such file or directory<br></code></pre></td></tr></table></figure><p>解决方法：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">ln -s /usr/lib64/libtinfo.so.6.1 /usr/lib64/libtinfo.so.5<br></code></pre></td></tr></table></figure><p>登录成功：</p><p><img src="/../image.assets/1664459241867.png" srcset="/img/loading.gif" lazyload alt="1664459241867"></p><h3 id="源码编译安装"><a href="#源码编译安装" class="headerlink" title="源码编译安装"></a>源码编译安装</h3><h1 id="MySQL多实例"><a href="#MySQL多实例" class="headerlink" title="MySQL多实例"></a>MySQL多实例</h1><h1 id="SQL语言"><a href="#SQL语言" class="headerlink" title="SQL语言"></a>SQL语言</h1><h2 id="SQL语言的兴起与语法标准"><a href="#SQL语言的兴起与语法标准" class="headerlink" title="SQL语言的兴起与语法标准"></a>SQL语言的兴起与语法标准</h2><h3 id="SQL语句分类"><a href="#SQL语句分类" class="headerlink" title="SQL语句分类"></a>SQL语句分类</h3><ul><li>DDL: Data Defination Language 数据定义语言<br>CREATE，DROP，ALTER</li><li>DML: Data Manipulation Language 数据操纵语言<br>INSERT，DELETE，UPDATE<br>软件开发：CRUD</li><li>DQL：Data Query Language 数据查询语言<br>SELECT</li><li>DCL：Data Control Language 数据控制语言<br>GRANT，REVOKE</li><li>TCL：Transaction Control Language 事务控制语言<br>COMMIT，ROLLBACK，SAVEPOINT</li></ul><h3 id="字符集和排序"><a href="#字符集和排序" class="headerlink" title="字符集和排序"></a>字符集和排序</h3><ul><li>查看所有支持的字符集</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span>;<br><span class="hljs-keyword">show</span> charset;<br></code></pre></td></tr></table></figure><ul><li>查看支持的所有排序</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-keyword">show</span> collation;<br><span class="hljs-meta">#注意</span><br>utf8_general_ci不区分大小写<br>utf8_bin 区分大小写<br></code></pre></td></tr></table></figure><ul><li>查看当前使用的排序规则</li></ul><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; show variables like &#x27;collation%&#x27;;</span><br><span class="hljs-section">+----------------------+-------------------+</span><br><span class="hljs-section">| Variable_name        | Value             |</span><br><span class="hljs-section">+----------------------+-------------------+</span><br>| collation<span class="hljs-emphasis">_connection | utf8_general_ci   |</span><br><span class="hljs-emphasis">| collation_database   | latin1_swedish_ci |</span><br><span class="hljs-emphasis">| collation_server     | latin1_swedish_</span>ci |<br><span class="hljs-code">+----------------------+</span>-------------------+<br>3 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><ul><li>设置服务器端默认字符集</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp">vim /etc/my.cnf<br><span class="hljs-meta">#针对mysql客户端</span><br>[<span class="hljs-meta">mysql</span>]<br><span class="hljs-literal">default</span>-character-<span class="hljs-keyword">set</span>=utf8mb4<br><span class="hljs-meta">#针对所有MySQL客户端</span><br>[<span class="hljs-meta">client</span>]<br><span class="hljs-literal">default</span>-character-<span class="hljs-keyword">set</span>=utf8mb4<br></code></pre></td></tr></table></figure><ul><li>查看当前字符集的使用情况</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; show variables like &#x27;character%&#x27;;<br>+--------------------------+----------------------------------------------------------------+<br>|<span class="hljs-string"> Variable_name            </span>|<span class="hljs-string"> Value                                                          </span>|<br>+--------------------------+----------------------------------------------------------------+<br>|<span class="hljs-string"> character_set_client     </span>|<span class="hljs-string"> utf8mb4                                                        </span>|<br>|<span class="hljs-string"> character_set_connection </span>|<span class="hljs-string"> utf8mb4                                                        </span>|<br>|<span class="hljs-string"> character_set_database   </span>|<span class="hljs-string"> latin1                                                         </span>|<br>|<span class="hljs-string"> character_set_filesystem </span>|<span class="hljs-string"> binary                                                         </span>|<br>|<span class="hljs-string"> character_set_results    </span>|<span class="hljs-string"> utf8mb4                                                        </span>|<br>|<span class="hljs-string"> character_set_server     </span>|<span class="hljs-string"> latin1                                                         </span>|<br>|<span class="hljs-string"> character_set_system     </span>|<span class="hljs-string"> utf8                                                           </span>|<br>|<span class="hljs-string"> character_sets_dir       </span>|<span class="hljs-string"> /usr/local/mysql-5.7.39-linux-glibc2.12-x86_64/share/charsets/ </span>|<br>+--------------------------+----------------------------------------------------------------+<br>8 rows in set (0.00 sec)<br><br>mysql&gt; <br></code></pre></td></tr></table></figure><p><strong>面试题: VARCHAR(50) 能存放几个 UTF8 编码的汉字？</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">存放的汉字个数与版本相关。<br>mysql <span class="hljs-number">4.0</span>以下版本，<span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) 指的是 <span class="hljs-number">50</span> 字节，如果存放 UTF8 格式编码的汉字时（每个汉字<span class="hljs-number">3</span>字<br>节），只能存放<span class="hljs-number">16</span> 个。<br>mysql <span class="hljs-number">5.0</span>以上版本，<span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) 指的是 <span class="hljs-number">50</span> 字符，无论存放的是数字、字母还是 UTF8 编码的汉字，<br>都可以存放 <span class="hljs-number">50</span> 个。<br></code></pre></td></tr></table></figure><h1 id="MySQL用户管理"><a href="#MySQL用户管理" class="headerlink" title="ＭySQL用户管理"></a>ＭySQL用户管理</h1><ul><li>相关数据库和表</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">元数据数据库：mysql<br>系统授权表：db, host, <span class="hljs-keyword">user</span>,columns_priv, tables_priv, procs_priv, proxies_priv<br></code></pre></td></tr></table></figure><ul><li>用户账号</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-string">&#x27;USERNAME&#x27;</span>@<span class="hljs-string">&#x27;HOST&#x27;</span><br>@<span class="hljs-string">&#x27;HOST&#x27;</span>: 主机名： <span class="hljs-symbol">user1@</span><span class="hljs-string">&#x27;web1.magedu.org&#x27;</span><br>IP地址或Network<br>通配符： % _<br>示例：<span class="hljs-symbol">wang@</span><span class="hljs-string">&#x27;172.16.%.%&#x27;</span><br><span class="hljs-symbol">user2@</span><span class="hljs-string">&#x27;192.168.1.%&#x27;</span><br><span class="hljs-symbol">mage@</span><span class="hljs-string">&#x27;10.0.0.0/255.255.0.0&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>创建用户：create user</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;USERNAME&#x27;</span>@<span class="hljs-string">&#x27;HOST&#x27;</span> [IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password&#x27;</span>]；<br>#示例:<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> test@<span class="hljs-string">&#x27;10.0.0.0/255.255.255.0&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> test2@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>新建用户的默认权限：USAGE</p><ul><li>用户重命名：RENAME USER</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">RENAME <span class="hljs-keyword">USER</span> <span class="hljs-title">old_user_name</span> TO new_user_name;<br></code></pre></td></tr></table></figure><ul><li>删除用户</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;USERNAME&#x27;</span>@<span class="hljs-string">&#x27;HOST&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>删除空用户</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>修改密码</strong></p><ul><li>注意</li></ul><p>新版mysql中用户密码可以保存在mysql.user表的authentication_string字段中<br>如果mysql.user表的authentication_string和password字段都保存密码，authentication_string<br>优先生效</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#方法<span class="hljs-number">1</span>,用户可以也可通过此方式修改自已的密码<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span> <span class="hljs-keyword">FOR</span> <span class="hljs-string">&#x27;user&#x27;</span>@<span class="hljs-string">&#x27;host&#x27;</span> = <span class="hljs-keyword">PASSWORD</span>(<span class="hljs-string">&#x27;password&#x27;</span>); #MySQL8<span class="hljs-number">.0</span> 版本不支持此方法,<br>因为<span class="hljs-keyword">password</span>函数被取消<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span>=<span class="hljs-string">&#x27;123456&#x27;</span> ; #MySQL8<span class="hljs-number">.0</span>版本支持此方法,此方式直接将密码<br><span class="hljs-number">123456</span>加密后存放在mysql.<span class="hljs-keyword">user</span>表的authentication_string字段<br>#方法<span class="hljs-number">2</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> test@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;centos&#x27;</span>; #通用改密码方法, 用户可以也可通过此方式修<br>改自已的密码,MySQL8 版本修改密码<br>#方法<span class="hljs-number">3</span> 此方式MySQL8<span class="hljs-number">.0</span>不支持,因为<span class="hljs-keyword">password</span>函数被取消<br><span class="hljs-keyword">UPDATE</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">password</span>=<span class="hljs-keyword">PASSWORD</span>(<span class="hljs-string">&#x27;password&#x27;</span>) <span class="hljs-keyword">WHERE</span> clause;<br><span class="hljs-meta">#mariadb 10.3</span><br><span class="hljs-keyword">update</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> authentication_string=<span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;ubuntu&#x27;</span>) <span class="hljs-keyword">where</span><br><span class="hljs-keyword">user</span>=<span class="hljs-string">&#x27;mage&#x27;</span>;<br>#此方法需要执行下面指令才能生效：<br>FLUSH <span class="hljs-keyword">PRIVILEGES</span>;<br></code></pre></td></tr></table></figure><p><strong>忘记管理员密码解决方法</strong></p><ol><li>启动mysqld进程时，为其使用如下选项：</li></ol><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">--skip-grant-tables</span><br><span class="hljs-comment">--skip-networking</span><br></code></pre></td></tr></table></figure><ol start="2"><li>使用UPDATE命令修改管理员密码</li><li>关闭mysqld进程，移除上述两个选项，重启mysqld</li></ol><p>范例:Mariadb 和MySQL5.6版之前破解root密码</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@centos8 ~]#vim /etc/my.cnf<br>[mysqld]<br>skip-<span class="hljs-keyword">grant</span>-<span class="hljs-keyword">tables</span><br>skip-networking<br>[root@centos8 ~]#systemctl <span class="hljs-keyword">restart</span> mysqld|mariadb<br>[root@centos8 ~]#mysql<br>#方法<span class="hljs-number">1</span><br><span class="hljs-meta">#mariadb 旧版和MySQL5.6版之前</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; <span class="hljs-keyword">update</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span>=<span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;ubuntu&#x27;</span>) <span class="hljs-keyword">where</span><br><span class="hljs-keyword">user</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-meta">#mariadb 新版</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; <span class="hljs-keyword">update</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> authentication_string=<span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;ubuntu&#x27;</span>)<br><span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br>#方法<span class="hljs-number">2</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; flush <span class="hljs-keyword">privileges</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;ubuntu&#x27;</span>;<br>[root@centos8 ~]#vim /etc/my.cnf<br>[mysqld]<br><span class="hljs-meta">#skip-grant-tables</span><br><span class="hljs-meta">#skip-networking</span><br><br>[root@centos8 ~]#systemctl <span class="hljs-keyword">restart</span> mysqld|mariadb<br>[root@centos8 ~]#mysql -uroot -pubuntu<br></code></pre></td></tr></table></figure><p>范例: MySQL5.7和8.0 破解root密码</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@centos8 ~</span>]<span class="hljs-meta">#vim /etc/my.cnf</span><br>[<span class="hljs-meta">mysqld</span>]<br>skip-grant-tables<br>skip-networking <span class="hljs-meta">#MySQL8.0不需要</span><br>[<span class="hljs-meta">root@centos8 ~</span>]<span class="hljs-meta">#systemctl restart mysqld</span><br><span class="hljs-meta">#方法1</span><br>mysql&gt; update mysql.user <span class="hljs-keyword">set</span> authentication_string=<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">where</span> user=<span class="hljs-string">&#x27;root&#x27;</span> <span class="hljs-keyword">and</span><br>host=<span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-meta">#方法2</span><br>mysql&gt; flush privileges;<br><span class="hljs-meta">#再执行下面任意一个命令</span><br>mysql&gt; alter user root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;ubuntu&#x27;</span>;<br>mysql&gt; <span class="hljs-keyword">set</span> password <span class="hljs-keyword">for</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span>=<span class="hljs-string">&#x27;ubuntu&#x27;</span>;<br>[<span class="hljs-meta">root@centos8 ~</span>]<span class="hljs-meta">#vim /etc/my.cnf</span><br>[<span class="hljs-meta">mysqld</span>]<br><span class="hljs-meta">#skip-grant-tables</span><br><span class="hljs-meta">#skip-networking</span><br>[<span class="hljs-meta">root@centos8 ~</span>]<span class="hljs-meta">#systemctl restart mysqld</span><br>[<span class="hljs-meta">root@centos8 ~</span>]<span class="hljs-meta">#mysql -uroot -pubuntu</span><br></code></pre></td></tr></table></figure><p>范例: 删库跑路之清空root密码方法</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#此方法适用于包安装方式的MySQL或Mariadb</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#systemctl stop mysqld</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#rm -rf /var/lib/mysql/*</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#systemctl start mysqld</span><br></code></pre></td></tr></table></figure><h1 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h1><p><strong>权限类别：</strong></p><ul><li><p>管理类</p></li><li><p>程序类</p></li><li><p>数据库级别</p></li><li><p>表级别</p></li><li><p>字段级别</p></li></ul><p><strong>管理类：</strong></p><ul><li>CREATE USER</li><li>FILE</li><li>SUPER</li><li>SHOW DATABASES</li><li>RELOAD</li><li>SHUTDOWN</li><li>REPLICATION SLAVE</li><li>REPLICATION CLIENT</li><li>LOCK TABLES</li><li>PROCESS</li><li>CREATE TEMPORARY TABLES</li></ul><p><strong>程序类：针对 FUNCTION、PROCEDURE、TRIGGER</strong></p><ul><li>CREATE</li><li>ALTER</li><li>DROP</li><li>EXCUTE<br><strong>库和表级别：针对 DATABASE、TABLE</strong></li><li>ALTER</li><li>CREATE</li><li>CREATE VIEW</li><li>DROP INDEX</li><li>SHOW VIEW</li><li>WITH GRANT OPTION：能将自己获得的权限转赠给其他用户<br><strong>数据操作</strong></li><li>SELECT<br>-INSERT</li><li>DELETE</li><li>UPDATE<br><strong>字段级别</strong></li><li>SELECT(col1,col2,…)</li><li>UPDATE(col1,col2,…)</li><li>INSERT(col1,col2,…)<br><strong>所有权限</strong></li><li>ALL PRIVILEGES 或 ALL</li></ul><p><strong>授权</strong></p><ul><li>授权：GRANT</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> (col1), <span class="hljs-keyword">INSERT</span> (col1,col2) <span class="hljs-keyword">ON</span> mydb.mytbl <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;someuser&#x27;</span>@<span class="hljs-string">&#x27;somehost&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">ON</span> wordpress.* <span class="hljs-keyword">TO</span> wordpress@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> ;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>;<br>#创建用户和授权同时执行的方式在MySQL8<span class="hljs-number">.0</span>取消了<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">ON</span> wordpress.* <span class="hljs-keyword">TO</span> wordpress@<span class="hljs-string">&#x27;192.168.8.%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;magedu&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;192.168.8.%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;magedu&#x27;</span><br><span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>;<br></code></pre></td></tr></table></figure><p><strong>取消授权</strong></p><ul><li>取消授权：REVOKE</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;testuser&#x27;</span>@<span class="hljs-string">&#x27;172.16.0.%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>查看指定用户获得的授权</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">Help <span class="hljs-keyword">SHOW</span> GRANTS<br><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> <span class="hljs-string">&#x27;user&#x27;</span>@<span class="hljs-string">&#x27;host&#x27;</span>;<br><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> <span class="hljs-built_in">CURRENT_USER</span>[()];<br></code></pre></td></tr></table></figure><p><strong>注意：</strong><br>MariaDB服务进程启动时会读取mysql库中所有授权表至内存<br>(1) GRANT或REVOKE等执行权限操作会保存于系统表中，MariaDB的服务进程通常会自动重读授权表，<br>使之生效<br>(2) 对于不能够或不能及时重读授权表的命令，可手动让MariaDB的服务进程重读授权表：<br>mysql&gt; FLUSH PRIVILEGES;</p><h1 id="MyISAM-存储引擎"><a href="#MyISAM-存储引擎" class="headerlink" title="MyISAM 存储引擎"></a>MyISAM 存储引擎</h1><h2 id="MyISAM-引擎特点"><a href="#MyISAM-引擎特点" class="headerlink" title="MyISAM 引擎特点"></a>MyISAM 引擎特点</h2><ul><li>不支持事务</li><li>表级锁定</li><li>读写相互阻塞，写入不能读，读时不能写</li><li>只缓存索引</li><li>不支持外键约束</li><li>不支持聚簇索引</li><li>读取数据较快，占用资源较少</li><li>不支持MVCC（多版本并发控制机制）高并发</li><li>崩溃恢复性较差</li><li>MySQL5.5.5 前默认的数据库引擎</li></ul><h2 id="MyISAM-存储引擎适用场景"><a href="#MyISAM-存储引擎适用场景" class="headerlink" title="MyISAM 存储引擎适用场景"></a>MyISAM 存储引擎适用场景</h2><ul><li>只读（或者写较少）</li><li>表较小（可以接受长时间进行修复操作）</li></ul><h2 id="MyISAM-引擎文件"><a href="#MyISAM-引擎文件" class="headerlink" title="MyISAM 引擎文件"></a>MyISAM 引擎文件</h2><ul><li>tbl_name.frm 表格式定义</li><li>tbl_name.MYD 数据文件</li><li>tbl_name.MYI 索引文件</li></ul><h1 id="InnoDB-引擎"><a href="#InnoDB-引擎" class="headerlink" title="InnoDB 引擎"></a>InnoDB 引擎</h1><h2 id="InnoDB引擎特点"><a href="#InnoDB引擎特点" class="headerlink" title="InnoDB引擎特点"></a>InnoDB引擎特点</h2><ul><li>行级锁</li><li>支持事务，适合处理大量短期事务</li><li>读写阻塞与事务隔离级别相关</li><li>可缓存数据和索引</li><li>支持聚簇索引</li><li>崩溃恢复性更好</li><li>支持MVCC高并发</li><li>从MySQL5.5后支持全文索引</li><li>从MySQL5.5.5开始为默认的数据库引擎</li></ul><h1 id="管理存储引擎"><a href="#管理存储引擎" class="headerlink" title="管理存储引擎"></a>管理存储引擎</h1><p>查看mysql支持的存储引擎</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">show engines<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>查看当前默认的存储引擎</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;%storage_engine%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>设置默认的存储引擎</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/my</span>.cnf<br>[mysqld]<br>default_storage_engine= InnoDB<br></code></pre></td></tr></table></figure><p>查看库中所有表使用的存储引擎</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">table</span> status <span class="hljs-keyword">from</span> db_name;<br></code></pre></td></tr></table></figure><p>查看库中指定表的存储引擎</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">table</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;tb_name&#x27;</span>;<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_name;<br></code></pre></td></tr></table></figure><p>设置表的存储引擎：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">CREATE</span></span> <span class="hljs-keyword">TABLE</span> tb_name(... ) ENGINE=InnoDB;<br>ALTER <span class="hljs-keyword">TABLE</span> tb_name <span class="hljs-comment">ENGINE=InnoDB</span>;<br></code></pre></td></tr></table></figure><h1 id="实战案例：数据库冷备份和热备份"><a href="#实战案例：数据库冷备份和热备份" class="headerlink" title="实战案例：数据库冷备份和热备份"></a>实战案例：数据库冷备份和热备份</h1><p>MySQL8.0</p><p>冷备份：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs autoit">备份过程<br><span class="hljs-meta"># 停止数据库</span><br>systemctl stop mysql<br><span class="hljs-meta"># rsync可以保留文件属性</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#rsync -a /var/lib/mysql 10.0.0.28:/data/</span><br><span class="hljs-meta">#如果配置及二进制文件相关有特殊设置也需要备份</span><br><span class="hljs-meta">#还原</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#yum -y install mysql-server</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#cp -a /data/mysql/* /var/lib/mysql/</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#systemctl start mysqld</span><br></code></pre></td></tr></table></figure><h1 id="mysqldump备份工具"><a href="#mysqldump备份工具" class="headerlink" title="mysqldump备份工具"></a>mysqldump备份工具</h1><p>mysqldump 说明<br>逻辑备份工具：<br>mysqldump, mydumper, phpMyAdmin<br>Schema和数据存储在一起、巨大的SQL语句、单个巨大的备份文件<br>mysqldump是MySQL的客户端命令，通过mysql协议连接至mysql服务器进行备份<br>命令格式:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">mysqldump <span class="hljs-selector-attr">[OPTIONS]</span> database <span class="hljs-selector-attr">[tables]</span> #支持指定数据库和指定多表的备份，但数据库本身定义<br>不备份<br>mysqldump <span class="hljs-selector-attr">[OPTIONS]</span> -<span class="hljs-selector-tag">B</span> DB1 <span class="hljs-selector-attr">[DB2 DB3...]</span> #支持指定数据库备份，包含数据库本身定义也会备份<br>mysqldump <span class="hljs-selector-attr">[OPTIONS]</span> -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-attr">[OPTIONS]</span> #备份所有数据库，包含数据库本身定义也会备份<br></code></pre></td></tr></table></figure><p>mysqldump参考：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>dev.mysql.com<span class="hljs-regexp">/doc/</span>refman<span class="hljs-regexp">/5.7/</span>en/mysqldump.html<br></code></pre></td></tr></table></figure><p>mysqldump 常见通用选项：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">-u, <span class="hljs-params">--user=name</span> User for login <span class="hljs-keyword">if</span> not current user<br>-p, <span class="hljs-params">--password</span>[=name] Password to use when connecting to server<br>-A, <span class="hljs-params">--all-databases</span> <span class="hljs-comment">#备份所有数据库，含create database</span><br>-B, <span class="hljs-params">--databases</span> db_name… <span class="hljs-comment">#指定备份的数据库，包括create database语句</span><br>-E, <span class="hljs-params">--events</span>：<span class="hljs-comment">#备份相关的所有event scheduler</span><br>-R, <span class="hljs-params">--routines</span>：<span class="hljs-comment">#备份所有存储过程和自定义函数</span><br><span class="hljs-params">--triggers</span>：<span class="hljs-comment">#备份表相关触发器，默认启用,用--skip-triggers，不备份触发器</span><br><span class="hljs-params">--default-character-set=utf8</span> <span class="hljs-comment">#指定字符集</span><br><span class="hljs-params">--master-data</span>[=<span class="hljs-comment">#]：#注意：MySQL8.0.26版以后，此选项变为--source-data</span><br><span class="hljs-comment">#此选项须启用二进制日志</span><br><span class="hljs-comment">#1：所备份的数据之前加一条记录为CHANGE MASTER TO语句，非注释，不指定#，默认为1，适合于主从复</span><br>制多机使用<br><span class="hljs-comment">#2：记录为被注释的#CHANGE MASTER TO语句，适合于单机使用,适用于备份还原</span><br><span class="hljs-comment">#此选项会自动关闭--lock-tables功能，自动打开-x | --lock-all-tables功能（除非开启--</span><br>single-transaction）<br>-F, <span class="hljs-params">--flush-logs</span> <span class="hljs-comment">#备份前滚动日志，锁定表完成后，执行flush logs命令,生成新的二进制日志文件，</span><br>配合-A 或 -B 选项时，会导致刷新多次数据库。建议在同一时刻执行转储和日志刷新，可通过和<span class="hljs-params">--single-</span><br>transaction或-x，<span class="hljs-params">--master-data</span> 一起使用实现，此时只刷新一次二进制日志<br><span class="hljs-params">--compact</span> <span class="hljs-comment">#去掉注释，适合调试，节约备份占用的空间,生产不使用</span><br>-d, <span class="hljs-params">--no-data</span> <span class="hljs-comment">#只备份表结构,不备份数据,即只备份create table</span><br>-t, <span class="hljs-params">--no-create-info</span> <span class="hljs-comment">#只备份数据,不备份表结构,即不备份create table</span><br>-n,<span class="hljs-params">--no-create-db</span> <span class="hljs-comment">#不备份create database，可被-A或-B覆盖</span><br><span class="hljs-params">--flush-privileges</span> <span class="hljs-comment">#备份mysql或相关时需要使用</span><br>-f, <span class="hljs-params">--force</span> <span class="hljs-comment">#忽略SQL错误，继续执行</span><br><span class="hljs-params">--hex-blob</span> <span class="hljs-comment">#使用十六进制符号转储二进制列，当有包括BINARY,VARBINARY,BLOB，</span><br>BIT的数据类型的列时使用，避免乱码<br>-q, <span class="hljs-params">--quick</span> <span class="hljs-comment">#不缓存查询，直接输出，加快备份速度</span><br></code></pre></td></tr></table></figure><p>mysqldump的MyISAM存储引擎相关的备份选项：<br>MyISAM不支持事务，只能支持温备；不支持热备，所以必须先锁定要备份的库，而后启动备份操作</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp">-x,--<span class="hljs-keyword">lock</span>-all-tables <span class="hljs-meta">#加全局读锁，锁定所有库的所有表，同时加--single-transaction或--</span><br><span class="hljs-keyword">lock</span>-tables选项会关闭此选项功能，注意：数据量大时，可能会导致长时间无法并发访问数据库<br>-l,--<span class="hljs-keyword">lock</span>-tables <span class="hljs-meta">#对于需要备份的每个数据库，在启动备份之前分别锁定其所有表，默认为on,--</span><br>skip-<span class="hljs-keyword">lock</span>-tables选项可禁用,对备份MyISAM的多个库,可能会造成数据不一致<br><span class="hljs-meta">#注：以上选项对InnoDB表一样生效，实现温备，但不推荐使用</span><br></code></pre></td></tr></table></figure><p>mysqldump的InnoDB存储引擎相关的备份选项：<br>InnoDB 存储引擎支持事务,可以利用事务的相应的隔离级别,实现热备，也可以实现温备但不建议用</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">--single-transaction</span><br>#此选项Innodb中推荐使用，不适用MyISAM，此选项会开始备份前，先执行<span class="hljs-keyword">START</span> <span class="hljs-keyword">TRANSACTION</span>指令开启<br>事务<br>#此选项通过在单个事务中转储所有表来创建一致的快照。 仅适用于存储在支持多版本控制的存储引擎中的表<br>（目前只有InnoDB可以）; 转储不保证与其他存储引擎保持一致。 在进行单事务转储时，要确保有效的转储<br>文件（正确的表内容和二进制日志位置），没有其他连接应该使用以下语句：<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>，<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span>，<br><span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TABLE</span>，<span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span>,此选项和<span class="hljs-comment">--lock-tables（此选项隐含提交挂起的事务）选项是相互</span><br>排斥,备份大型表时，建议将<span class="hljs-comment">--single-transaction选项和--quick结合一起使用</span><br></code></pre></td></tr></table></figure><h1 id="生产环境实战备份策略"><a href="#生产环境实战备份策略" class="headerlink" title="生产环境实战备份策略"></a>生产环境实战备份策略</h1><p>InnoDB建议备份策略</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">mysqldump -uroot -p -A -F -E -R <span class="hljs-params">--triggers</span> <span class="hljs-params">--single-transaction</span> <span class="hljs-params">--master-data=1</span><br><span class="hljs-params">--flush-privileges</span> <span class="hljs-params">--default-character-set=utf8</span> <span class="hljs-params">--hex-blob</span><br>&gt;$&#123;BACKUP&#125;<span class="hljs-string">/fullbak_</span>$&#123;BACKUP_TIME&#125;<span class="hljs-string">.sql</span><br></code></pre></td></tr></table></figure><p>MyISAM建议备份策略</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">mysqldump -uroot -p -A -F -E -R -x <span class="hljs-params">--master-data=1</span> <span class="hljs-params">--flush-privileges</span> --<br>triggers <span class="hljs-params">--default-character-set=utf8</span> <span class="hljs-params">--hex-blob</span><br>&gt;$&#123;BACKUP&#125;<span class="hljs-string">/fullbak_</span>$&#123;BACKUP_TIME&#125;<span class="hljs-string">.sql</span><br></code></pre></td></tr></table></figure><h1 id="mysqldump-备份还原实战案例"><a href="#mysqldump-备份还原实战案例" class="headerlink" title="mysqldump 备份还原实战案例"></a>mysqldump 备份还原实战案例</h1><h2 id="实战案例：特定数据库的备份脚本"><a href="#实战案例：特定数据库的备份脚本" class="headerlink" title="实战案例：特定数据库的备份脚本"></a>实战案例：特定数据库的备份脚本</h2><p>系统：centos8.5</p><p>mysql:8.0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>TIME=`<span class="hljs-built_in">date</span> +%F_%H-%M-%S`<br><span class="hljs-comment"># 备份目录</span><br>DIR=/mysql_backup<br><span class="hljs-comment"># 备份数据库</span><br>DB=hellodb<br><span class="hljs-comment"># 数据库密码</span><br>PASSWD=123456<br><br><span class="hljs-comment"># 判断备份数据库目录是否存在</span><br><br>[ -d <span class="hljs-variable">$DIR</span> ] || <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$DIR</span><br><br><span class="hljs-comment"># 备份</span><br>mysqldump -uroot -p<span class="hljs-string">&quot;<span class="hljs-variable">$PASSWD</span>&quot;</span> -F -E -R --triggers --single-transaction --master-data=2 --default-character-set=utf8mb4 -q -B <span class="hljs-variable">$DB</span> | gzip &gt; <span class="hljs-variable">$&#123;DIR&#125;</span>/<span class="hljs-variable">$&#123;DB&#125;</span>_<span class="hljs-variable">$&#123;TIME&#125;</span>.sql.gz<br></code></pre></td></tr></table></figure><h1 id="实战案例：分库备份的实战脚本"><a href="#实战案例：分库备份的实战脚本" class="headerlink" title="实战案例：分库备份的实战脚本"></a>实战案例：分库备份的实战脚本</h1><ul><li>系统：centos8.5</li><li>MySQL版本：8.0</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>TIME=`<span class="hljs-built_in">date</span> +%F_%H-%M-%S`<br>DIR=/backup<br>PASS=123456<br>[ -d <span class="hljs-string">&quot;<span class="hljs-variable">$DIR</span>&quot;</span> ] || <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$DIR</span><br><span class="hljs-keyword">for</span> DB <span class="hljs-keyword">in</span> `mysql -uroot -p<span class="hljs-string">&quot;<span class="hljs-variable">$PASS</span>&quot;</span> -e <span class="hljs-string">&#x27;show databases&#x27;</span> | grep -Ev <span class="hljs-string">&quot;^Database|.*schema$&quot;</span>`;<span class="hljs-keyword">do</span><br>    mysqldump -uroot -p<span class="hljs-string">&quot;<span class="hljs-variable">$PASS</span>&quot;</span> -F --single-transaction --master-data=2 --default-character-set=utf8mb4 -q -B <span class="hljs-variable">$DB</span> | gzip &gt; <span class="hljs-variable">$&#123;DIR&#125;</span>/<span class="hljs-variable">$&#123;DB&#125;</span>_<span class="hljs-variable">$&#123;TIME&#125;</span>.sql.gz<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h1 id="实战案例：完全备份和还原"><a href="#实战案例：完全备份和还原" class="headerlink" title="实战案例：完全备份和还原"></a>实战案例：完全备份和还原</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#开启二进制日志<br>[root@centos8 ~]#vim /etc/my.cnf.d/mariadb-<span class="hljs-keyword">server</span>.cnf<br>[mysqld]<br><span class="hljs-keyword">log</span>-bin<br>#备份<br>[root@centos8 ~]#mysqldump -uroot -pmagedu -A -F <span class="hljs-comment">--single-transaction --master-</span><br>data=<span class="hljs-number">2</span> |gzip &gt; /backup/<span class="hljs-keyword">all</span>-`<span class="hljs-type">date</span> +%F`.<span class="hljs-keyword">sql</span>.gz<br>#还原<br>[root@centos8 backup]#dnf install mariadb-<span class="hljs-keyword">server</span><br>[root@centos8 backup]#gzip -d <span class="hljs-keyword">all</span><span class="hljs-number">-2019</span><span class="hljs-number">-11</span><span class="hljs-number">-27.</span><span class="hljs-keyword">sql</span>.gz<br>[root@centos8 ~]#mysql<br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; <span class="hljs-keyword">set</span> sql_log_bin=<span class="hljs-keyword">off</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; source /backup/<span class="hljs-keyword">all</span><span class="hljs-number">-2019</span><span class="hljs-number">-11</span><span class="hljs-number">-27.</span><span class="hljs-keyword">sql</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt; <span class="hljs-keyword">set</span> sql_log_bin=<span class="hljs-keyword">on</span>;<br></code></pre></td></tr></table></figure><h1 id="实战案例：恢复误删除的表"><a href="#实战案例：恢复误删除的表" class="headerlink" title="实战案例：恢复误删除的表"></a>实战案例：恢复误删除的表</h1><p>案例说明：每天2：30做完全备份，早上10：00误删除了表students，10：10才发现故障，现需要将数<br>据库还原到10：10的状态，且恢复被删除的students表</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">#查看数据库是否开启二进制<br><span class="hljs-section">mysql&gt; select @@log_bin;</span><br><span class="hljs-section">+-----------+</span><br><span class="hljs-section">| @@log_bin |</span><br><span class="hljs-section">+-----------+</span><br><span class="hljs-section">|         1 |</span><br><span class="hljs-section">+-----------+</span><br>1 row in set (0.01 sec)<br><br><span class="hljs-section">mysql&gt; select @@sql_log_bin;</span><br><span class="hljs-section">+---------------+</span><br><span class="hljs-section">| @@sql_log_bin |</span><br><span class="hljs-section">+---------------+</span><br><span class="hljs-section">|             1 |</span><br><span class="hljs-section">+---------------+</span><br>1 row in set (0.01 sec)<br><br>mysql&gt; <br><br># log_bin、sql_log_bin的值为1说明已经开启二进制日志<br><br># 查看当前二进制文件在什么位置<br><span class="hljs-section">mysql&gt; show master logs;</span><br><span class="hljs-section">+------------------+-----------+-----------+</span><br><span class="hljs-section">| Log_name         | File_size | Encrypted |</span><br><span class="hljs-section">+------------------+-----------+-----------+</span><br>| mysql-bin.000001 |       204 | No        |<br><span class="hljs-section">| mysql-bin.000002 |       157 | No        |</span><br><span class="hljs-section">+------------------+-----------+-----------+</span><br>2 rows in set (0.01 sec)<br><br>mysql&gt; <br># 备份的时候开启刷新二进制日志，会生成新的二进制的日志<br><br>#完全备份<br>[root@centos7 ~]# mysqldump -uroot -p123456 -A -F --single-transaction --master-data=2 | gzip &gt; /backup/all_<span class="hljs-code">`date +%F`</span>.sql.gz<br><br># 完全备份后进行数据更新<br>mysql&gt; insert students (name,age,gender) values(<span class="hljs-emphasis">&#x27;jack&#x27;</span>,22,<span class="hljs-emphasis">&#x27;M&#x27;</span>);<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt; insert students (name,age,gender) values(<span class="hljs-emphasis">&#x27;rose&#x27;</span>,20,<span class="hljs-emphasis">&#x27;f&#x27;</span>);<br>Query OK, 1 row affected (0.01 sec)<br><br># 误删除学生表<br>mysql&gt; drop table students;<br>Query OK, 0 rows affected (0.07 sec)<br><br>mysql&gt; <br><br># 后续其他表继续更新<br>mysql&gt; insert teachers (name,age,gender)values(<span class="hljs-emphasis">&#x27;wang&#x27;</span>,30,<span class="hljs-emphasis">&#x27;M&#x27;</span>);<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt; <br><br>mysql&gt; insert teachers (name,age,gender)values(<span class="hljs-emphasis">&#x27;mage&#x27;</span>,28,<span class="hljs-emphasis">&#x27;M&#x27;</span>);<br>Query OK, 1 row affected (0.05 sec)<br><br>mysql&gt; <br><br># 停止数据库访问<br><br># 备份从完全备份后的二进制日志<br>[root@centos7 ~]# mysqlbinlog --start-position=157 /data/mysql/mysql-bin.000003 &gt; /backup/inc.sql<br><br># 找到误删除的语句，从备份中删除此语句<br>#DROP TABLE <span class="hljs-code">`students`</span> /* generated by server */<br>#利用完全备份和修改过的二进制日志进行还原<br>[root@centos8 ~]#mysql -uroot -p<br>mysql&gt; set sql<span class="hljs-emphasis">_log_bin=0;</span><br><span class="hljs-emphasis">mysql&gt; source /backup/allbackup_2019-11-27_10:20:08.sql;</span><br><span class="hljs-emphasis">mysql&gt; source /backup/inc.sql</span><br><span class="hljs-emphasis">mysql&gt; set sql_log_</span>bin=1;<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/MySQL/" class="category-chain-item">MySQL</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/MySQL%E5%9F%BA%E7%A1%80/">#MySQL基础</a></div></div><div class="license-box my-3"><div class="license-title"><div>MySQL数据库基础和安装使用</div><div>https://hugo.itshare.work/2022/09/28/MySQL/</div></div><div class="license-meta"><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年9月28日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2023年3月3日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/09/30/MySQLinstallScript/" title="在线一键安装MySQL脚本"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">在线一键安装MySQL脚本</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/09/25/FireWall/" title="Linux防火墙"><span class="hidden-mobile">Linux防火墙</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",(function(){var i=Object.assign({appId:"hQDROocUhxVs3CipuQjO33sY-gzGzoHsz",appKey:"CHcmi9bz6KRRaChFJVSY14g1",path:"window.location.pathname",placeholder:"请在这里书写你想说的话······",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:"",emojiCDN:null,emojiMaps:null,enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><span>由<a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>强力驱动</span> <i class="iconfont icon-love"></i> <span>主题</span> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <span>©2022 - 2023</span></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访问客数 <span id="leancloud-site-uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/caidai.js"></script><script src="/js/love.main.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>