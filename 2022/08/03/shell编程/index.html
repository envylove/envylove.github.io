<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico"><link rel="icon" href="/img/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="勒马听风"><meta name="keywords" content="hexo,theme,fluid,linux,ops,运维,分享"><meta name="description" content="shell 是操作系统的最外层。shell 合并编程语言以控制进程和文件，以及启动和控制其它程序。shell 通过提示您输入，向操作系统解释该输入，然后处理来自操作系统的任何结果输出来管理您与操作系统之间的交互。"><meta property="og:type" content="article"><meta property="og:title" content="shell编程"><meta property="og:url" content="https://itshare.work/2022/08/03/shell%E7%BC%96%E7%A8%8B/index.html"><meta property="og:site_name" content="勾三股四"><meta property="og:description" content="shell 是操作系统的最外层。shell 合并编程语言以控制进程和文件，以及启动和控制其它程序。shell 通过提示您输入，向操作系统解释该输入，然后处理来自操作系统的任何结果输出来管理您与操作系统之间的交互。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://itshare.work/banner_img/default.png"><meta property="article:published_time" content="2022-08-03T14:23:02.000Z"><meta property="article:modified_time" content="2022-12-16T14:59:07.603Z"><meta property="article:author" content="yuankun"><meta property="article:tag" content="Linux从入门到放弃"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://itshare.work/banner_img/default.png"><title>shell编程 - 勾三股四</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/tbdzj.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"itshare.work",root:"/",version:"1.9.3",typing:{enable:!1,typeSpeed:70,cursorChar:" ",loop:!0,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"text"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"hQDROocUhxVs3CipuQjO33sY-gzGzoHsz",app_key:"CHcmi9bz6KRRaChFJVSY14g1",server_url:"https://hqdroocu.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>勾三股四</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">shell编程</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-08-03 22:23" pubdate>2022年8月3日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 35k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 291 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">shell编程</h1><div class="markdown-body"><h1 id="内容简述"><a href="#内容简述" class="headerlink" title="内容简述"></a>内容简述</h1><p>shell 是操作系统的最外层。shell 合并编程语言以控制进程和文件，以及启动和控制其它程序。shell 通过提示您输入，向操作系统解释该输入，然后处理来自操作系统的任何结果输出来管理您与操作系统之间的交互。</p><h1 id="1-编程基础"><a href="#1-编程基础" class="headerlink" title="1.编程基础"></a>1.编程基础</h1><p>Linus：Talk is cheap, show me the code</p><h2 id="1-1-程序组成"><a href="#1-1-程序组成" class="headerlink" title="1.1 程序组成"></a>1.1 程序组成</h2><ul><li>程序：算法+数据结构</li><li>算法：处理数据的方式</li><li>数据结构：数据在计算机中的类型和组织方式</li><li>数据：是程序的核心，程序为数据提供服务</li></ul><h2 id="1-2-程序编程风格"><a href="#1-2-程序编程风格" class="headerlink" title="1.2 程序编程风格"></a>1.2 程序编程风格</h2><ul><li>面向过程语言<ul><li>做一件事情，排出个步骤，第一步干什么，第二步干什么，如果出现情况A，做什么处理，如果出现了情况B，做什么处理</li><li>问题规模小，可以步骤化，按部就班处理</li><li>以指令为中心，数据服务于指令</li><li>C，shell</li></ul></li><li>面向对象语言<ul><li>将编程看成是一个事物，对外界来说，事物是直接使用的,不用关心事物内部的情况。而编程就是设置事物能够完成功能。</li><li>一种认识世界、分析世界的方法论。将万事万物抽象为各种对象</li><li>类是抽象的概念，是万事万物的抽象，是一类事物的共同特征的集合</li><li>对象是类的具体实现，是一个实体</li><li>问题规模大，复杂系统</li><li>以数据为中心，指令服务于数据</li><li>java，C#，python，golang等</li></ul></li></ul><h2 id="1-3-编程语言"><a href="#1-3-编程语言" class="headerlink" title="1.3 编程语言"></a>1.3 编程语言</h2><p><strong>编程语言排行榜链接</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">https://www.tiobe.com/tiobe-index/<br></code></pre></td></tr></table></figure><p>计算机：运行二进制指令<br>编程语言：人与计算机之间交互的语言。分为两种：低级语言和高级语言</p><ul><li>低级编程语言：<ul><li>机器：二进制的0和1的序列，称为机器指令。与自然语言差异太大，难懂、难写</li><li>汇编：用一些助记符号替代机器指令，称为汇编语言<br>如：ADD A,B 将寄存器A的数与寄存器B的数相加得到的数放到寄存器A中<br>汇编语言写好的程序需要汇编程序转换成机器指令<br>汇编语言稍微好理解，即机器指令对应的助记符，助记符更接近自然语言</li></ul></li><li>高级编程语言：<ul><li>编译：高级语言–&gt;编译器–&gt;机器代码文件–&gt;执行，如：C，C++</li><li>解释：高级语言–&gt;执行–&gt;解释器–&gt;机器代码，如：shell，python，php，JavaScript，perl</li></ul></li><li>编译和解释型语言<br><img src="/../image.assets/1659747737724.png" srcset="/img/loading.gif" lazyload alt="1659747737724"></li></ul><h2 id="1-4-编程逻辑处理方式"><a href="#1-4-编程逻辑处理方式" class="headerlink" title="1.4 编程逻辑处理方式"></a>1.4 编程逻辑处理方式</h2><p><img src="/../image.assets/1659747842228.png" srcset="/img/loading.gif" lazyload alt="1659747842228"></p><p><img src="/../image.assets/1659747863045.png" srcset="/img/loading.gif" lazyload alt="1659747863045"></p><p><strong>三种处理逻辑</strong></p><ul><li>顺序执行：程序按从上到下顺序执行</li><li>选择执行：程序执行过程中，根据条件的不同，进行选择不同分支继续执行</li><li>循环执行：程序执行过程中需要重复执行多次某段语句</li></ul><h1 id="2-shell-脚本语言的基本用法"><a href="#2-shell-脚本语言的基本用法" class="headerlink" title="2.shell 脚本语言的基本用法"></a>2.shell 脚本语言的基本用法</h1><h2 id="2-1-shell-脚本的用途"><a href="#2-1-shell-脚本的用途" class="headerlink" title="2.1 shell 脚本的用途"></a>2.1 shell 脚本的用途</h2><ul><li>将简单的命令组合完成复杂的工作,自动化执行命令,提高工作效率</li><li>减少手工命令的输入，一定程度上避免人为错误</li><li>将软件或应用的安装及配置实现标准化</li><li>用于实现日常性的,重复性的,非交互式的运维工作,如:文件打包压缩备份,监控系统运行状态并实现告警等</li></ul><h2 id="2-2-shell脚本基本结构"><a href="#2-2-shell脚本基本结构" class="headerlink" title="2.2 shell脚本基本结构"></a>2.2 shell脚本基本结构</h2><p><strong>shell脚本编程：是基于过程式、解释执行的语言</strong></p><hr><p><strong>编程语言的基本结构：</strong></p><ul><li>各种系统命令的组合</li><li>数据存储：变量、数组</li><li>表达式：a + b</li><li>控制语句：if</li></ul><p>shell脚本：包含一些命令或声明，并符合一定格式的文本文件<br>格式要求：首行shebang机制</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/bin/bash<br>#!/usr/bin/python<br>#!/usr/bin/perl<br>#!/usr/bin/ruby<br>#!/usr/bin/lua<br></code></pre></td></tr></table></figure><h2 id="2-3-shell脚本创建过程"><a href="#2-3-shell脚本创建过程" class="headerlink" title="2.3 shell脚本创建过程"></a>2.3 shell脚本创建过程</h2><p><strong>第一步：使用文本编编辑器来创建文本文件</strong></p><p><strong>第一行必须包括shell声明序列：#!</strong><br>示例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash	<span class="hljs-comment"># 使用bash，添加注释,注释以#开头</span></span>	<br></code></pre></td></tr></table></figure><p>第二步：加执行权限<br>给予执行权限，在命令行上指定脚本的绝对或相对路径<br>第三步：运行脚本<br>直接运行解释器，将脚本作为解释器程序的参数运行</p><p><strong>扩展：查看当前使用的是何种shell，终端输入：echo $SHELL</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:~# echo $SHELL<br>/bin/bash<br>root@ubuntu200404:~#<br></code></pre></td></tr></table></figure><h2 id="2-4-shell脚本注释规范"><a href="#2-4-shell脚本注释规范" class="headerlink" title="2.4 shell脚本注释规范"></a>2.4 shell脚本注释规范</h2><ul><li>第一行一般为调用使用的语言</li><li>程序名，避免更改文件名为无法找到正确的文件</li><li>版本号</li><li>更改后的时间</li><li>作者相关信息</li><li>该程序的作用，及注意事项</li><li>最后是各版本的更新简要说明</li></ul><h2 id="2-5-第一个shell脚本"><a href="#2-5-第一个shell脚本" class="headerlink" title="2.5 第一个shell脚本"></a>2.5 第一个shell脚本</h2><p><strong>范例：第一个shell脚本hello world</strong></p><p><strong>参考文档：</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">https://zh.wikipedia.org/wiki/Hello_World<br>https://zh.wikipedia.org/wiki/Hello_World%E7%A8%8B%E5%BA%8F%E6%A0%B7%E4%BE%8B<br></code></pre></td></tr></table></figure><p>(程序样例)[<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Hello_World]">https://zh.wikipedia.org/wiki/Hello_World]</a></p><p><strong>第一步：vim创建hello.sh文本</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># vim hello.sh</span><br></code></pre></td></tr></table></figure><p><strong>第二步：声明序列和添加脚本名称、日期等</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">#!/bin/bash<br>#******************<br>#filename:hello.<span class="hljs-keyword">sh</span><br>#Dat<span class="hljs-variable">a:2022</span>-<span class="hljs-number">08</span>-<span class="hljs-number">06</span><br>#author:admin<br>#******************<br></code></pre></td></tr></table></figure><p><strong>第三步：编写代码</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">经典写法</span><br>echo &quot;hello, world&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">流行写法</span><br>echo &#x27;Hello, world!&#x27;<br></code></pre></td></tr></table></figure><p><strong>第四步：执行shell脚本</strong></p><p>方法一：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:~# bash hello.sh <br>hello world!<br>******************<br>hello world!<br>root@ubuntu200404:~# <br></code></pre></td></tr></table></figure><p>方法二：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:/data/scripts# cat /data/scripts/hello.sh | bash<br>hello world!<br>******************<br>hello world!<br>root@ubuntu200404:/data/scripts#<br></code></pre></td></tr></table></figure><p>方法三：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:/data/scripts# bash &lt; /data/scripts/hello.sh <br>hello world!<br>******************<br>hello world!<br>root@ubuntu200404:/data/scripts# <br></code></pre></td></tr></table></figure><p>方法四：添加执行权限使用绝对路径和相对路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">绝对路径</span><br>root@ubuntu200404:/data/scripts# /data/scripts/hello.sh <br>hello world!<br>******************<br>hello world!<br>root@ubuntu200404:/data/scripts# <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">相对路径</span><br>root@ubuntu200404:/data/scripts# pwd<br>/data/scripts<br>root@ubuntu200404:/data/scripts# ./hello.sh <br>hello world!<br>******************<br>hello world!<br>root@ubuntu200404:/data/scripts#<br></code></pre></td></tr></table></figure><p>方法五：将脚本添加到path变量中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">当前path位置</span><br>root@ubuntu200404:/data/scripts# echo $PATH<br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br>root@ubuntu200404:/data/scripts#<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">给hello.sh文件创建软链接放到/usr/local/bin目录下</span><br>root@ubuntu200404:/data/scripts# ln -s /data/scripts/hello.sh /usr/local/bin/ <br>root@ubuntu200404:/data/scripts# ls /usr/local/bin/						<br>hello.sh<br>root@ubuntu200404:/data/scripts#<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">执行shell脚本</span><br>root@ubuntu200404:/data/scripts# hello.sh <br>hello world!<br>******************<br>hello world!<br>root@ubuntu200404:/data/scripts#<br></code></pre></td></tr></table></figure><p>方法六：本方法可以实现执行远程主机的shell脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">扩展：curl加-s选项不显示下载信息</span><br>root@ubuntu200404:/data# curl -s http://wangxiaochun.com/testdir/hello.sh |bash<br>hello, world<br>Hello, world!<br>root@ubuntu200404:/data# <br></code></pre></td></tr></table></figure><p>案例：备份脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">脚本内容</span><br>root@ubuntu200404:/data/scripts# cat -n bacup.sh <br>     1	#!/bin/bash<br>     2	#------------------<br>     3	#filename:bacup.sh<br>     4	#备份脚本<br>     5	#------------------<br>     6	<br>     7	<br>     8	tar zcf /data/scripts-`date +%F_%s`.tar.gz /data/ &amp;&gt; /dev/null<br>     9	<br>    10	echo -e &quot;\E[1;32mbacup is success!\E[0m&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">执行脚本</span><br>root@ubuntu200404:/data/scripts# bash bacup.sh <br>bacup is success!<br>root@ubuntu200404:/data/scripts#<br></code></pre></td></tr></table></figure><h2 id="2-6-shell脚本调试"><a href="#2-6-shell脚本调试" class="headerlink" title="2.6 shell脚本调试"></a>2.6 shell脚本调试</h2><p><strong>只检测脚本中的语法错误，但无法检查出命令错误，但不真正执行脚本</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash -n /path/to/some_script<br></code></pre></td></tr></table></figure><p><strong>调试并执行</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash -x /path/to/some_script<br></code></pre></td></tr></table></figure><p><strong>案例1：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:/data/scripts# bash -x hello.sh <br>+ echo &#x27;hello world!&#x27;<br>hello world!<br>+ echo &#x27;******************&#x27;<br>******************<br>+ echo &#x27;hello world!&#x27;<br>hello world!<br>root@ubuntu200404:/data/scripts# <br></code></pre></td></tr></table></figure><p><strong>案例2:多行重定向</strong></p><p>脚本内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">多行重定向</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">data:2022-08-06</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">author:admin</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--------------------------------------------</span><br><br>echo start<br><br>cat &gt;/data/demo.conf &lt;&lt;EOF<br>line 1<br>line 2<br>line 3<br>EOF <br><br>echo end<br>root@ubuntu200404:/data/scripts# <br></code></pre></td></tr></table></figure><p>检查错误：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:/data/scripts# bash -n demo1.sh <br>demo1.sh: line 17: warning: here-document at line 11 delimited by end-of-file (wanted `EOF&#x27;)<br>root@ubuntu200404:/data/scripts# <br></code></pre></td></tr></table></figure><p>检查出第十七行有错误，肉眼观察没有错误，这是因为有些错误不显示在屏幕上的，可以通过cat -A filename或者在vi命令行模式下输入：set list</p><p><img src="/../image.assets/1659754821095.png" srcset="/img/loading.gif" lazyload alt="1659754821095"></p><p>使用cat -A filename命令后发现EOF后面多了个空格导致错误。删除掉空格脚本即可成功运行。</p><p>在vi命令行模式下输入set list</p><p><img src="/../image.assets/1659754927224.png" srcset="/img/loading.gif" lazyload alt="1659754927224"></p><p><strong>总结：脚本错误常见的有三种</strong></p><ul><li>语法错误，会导致后续的命令不继续执行，可以用bash -n 检查错误，提示的出错行数不一定是准<br>确的</li><li>命令错误，默认后续的命令还会继续执行，用bash -n 无法检查出来 ，可以使用 bash -x 进行观察</li><li>逻辑错误：只能使用 bash -x 进行观察</li></ul><h2 id="2-7-变量"><a href="#2-7-变量" class="headerlink" title="2.7 变量"></a>2.7 变量</h2><h3 id="2-7-1-变量"><a href="#2-7-1-变量" class="headerlink" title="2.7.1 变量"></a>2.7.1 变量</h3><p><strong>变量表示命名的内存空间，将数据放在内存空间中，通过变量名引用，获取数据</strong></p><hr><h3 id="2-7-2-变量类型"><a href="#2-7-2-变量类型" class="headerlink" title="2.7.2 变量类型"></a>2.7.2 变量类型</h3><p><strong>变量类型：</strong></p><ul><li>内置变量，如：PS1，PATH，UID，HOSTNAME，$$，BASHPID，PPID，$?，HISTSIZE</li><li>用户自定义变量</li></ul><p><strong>不同的变量存放的数据不同，决定了以下</strong></p><ul><li>数据存储方式</li><li>参与的运算</li><li>表示的数据范围</li></ul><p><strong>变量数据类型：</strong></p><ul><li>字符</li><li>数值：整型、浮点型,bash 不支持浮点数</li></ul><h3 id="2-7-3-shell中变量命令规则"><a href="#2-7-3-shell中变量命令规则" class="headerlink" title="2.7.3 shell中变量命令规则"></a>2.7.3 shell中变量命令规则</h3><h4 id="2-7-3-1-命名要求"><a href="#2-7-3-1-命名要求" class="headerlink" title="2.7.3.1 命名要求"></a>2.7.3.1 命名要求</h4><ul><li><p>区分大小写</p></li><li><p>不能使程序中的保留字和内置变量：如：if, for<br>只能使用数字、字母及下划线，且不能以数字开头，注意：不支持短横线 “ - ”，和主机名相反</p></li><li><p>只能使用数字、字母及下划线，且不能以数字开头，注意：不支持短横线 “ - ”，和主机名相反</p></li></ul><h4 id="2-7-3-2-命令习惯"><a href="#2-7-3-2-命令习惯" class="headerlink" title="2.7.3.2 命令习惯"></a>2.7.3.2 命令习惯</h4><ul><li>见名知义，用英文单词命名，并体现出实际作用，不要用简写，如：ATM</li><li>变量名大写</li><li>局部变量小写</li><li>函数名小写</li><li>大驼峰StudentFirstName,由多个单词组成，且每个单词的首字母是大写，其它小写</li><li>小驼峰studentFirstName ,由多个单词组成，第一个单词的首字母小写，后续每个单词的首字母是大写，其它小写</li><li>下划线: student_name</li></ul><h3 id="2-7-4-变量定义和引用"><a href="#2-7-4-变量定义和引用" class="headerlink" title="2.7.4 变量定义和引用"></a>2.7.4 变量定义和引用</h3><p><strong>变量的生效范围等标准划分变量类型</strong></p><ul><li>普通变量：生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效</li><li>环境变量：生效范围为当前shell进程及其子进程</li><li>本地变量：生效范围为当前shell进程中某代码片断，通常指函数</li></ul><p><strong>变量赋值：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">name=&#x27;value&#x27;<br></code></pre></td></tr></table></figure><p><strong>value 可以是以下多种形式</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">直接字串：name=&#x27;root&#x27;<br>变量引用：name=&quot;$USER&quot;<br>命令引用：name=`COMMAND` 或者 name=$(COMMAND)<br></code></pre></td></tr></table></figure><p><strong>注意：</strong>变量赋值是临时生效，当退出终端后，变量会自动删除，无法持久保存，脚本中的变量会随着脚本结束，也会自动删除</p><p><strong>变量引用：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">name</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;name&#125;</span><br></code></pre></td></tr></table></figure><p><strong>弱引用和强引用</strong></p><ul><li>“$name” 弱引用，其中的变量引用会被替换为变量值</li><li>‘$name’ 强引用，其中的变量引用不会被替换为变量值，而保持原字符串</li></ul><p><strong>范例：变量的各种赋值方式和引用</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell">方式1：<br>root@ubuntu200404:/data/scripts# TITLE=cto<br>root@ubuntu200404:/data/scripts# echo $TITLE<br>cto<br>root@ubuntu200404:/data/scripts#<br><br>方式二：<br>root@ubuntu200404:/data/scripts# T=ceo<br>root@ubuntu200404:/data/scripts# NAME=$T<br>root@ubuntu200404:/data/scripts# echo $NAME<br>ceo<br>root@ubuntu200404:/data/scripts#<br><br>方式三：<br>root@ubuntu200404:/data/scripts# NAME=`whoami`<br>root@ubuntu200404:/data/scripts# echo $NAME<br>root<br>root@ubuntu200404:/data/scripts#<br><br>方式四：<br>root@ubuntu200404:/data/scripts# seq 10<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>root@ubuntu200404:/data/scripts#<br><span class="hljs-meta prompt_"># </span><span class="language-bash">弱引用</span><br>root@ubuntu200404:/data/scripts# echo &quot;$NUM&quot;<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>root@ubuntu200404:/data/scripts# <br></code></pre></td></tr></table></figure><p><strong>删除变量： unset name</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">unset &lt;name&gt;<br>案例：<br>root@ubuntu200404:/data/scripts# NUM=`seq 10`<br>root@ubuntu200404:/data/scripts# echo $NUM<br>1 2 3 4 5 6 7 8 9 10<br>root@ubuntu200404:/data/scripts# unset NUM<br>root@ubuntu200404:/data/scripts# echo $NUM<br><br>root@ubuntu200404:/data/scripts# <br></code></pre></td></tr></table></figure><p><strong>显示已有的变量</strong></p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">set</span><br></code></pre></td></tr></table></figure><h3 id="2-7-5-环境变量"><a href="#2-7-5-环境变量" class="headerlink" title="2.7.5 环境变量"></a>2.7.5 环境变量</h3><p><strong>环境变量：</strong></p><ul><li>可以使子进程（包括孙子进程）继承父进程的变量，但是无法让父进程使用子进程的变量</li><li>一旦子进程修改从父进程继承的变量，将会新的值传递给孙子进</li><li>一般只在系统配置文件中使用，在脚本中较少使用</li></ul><p><strong>变量声明和赋值：</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#声明并赋值</span><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">name</span>=VALUE<br>declare -x <span class="hljs-attribute">name</span>=VALUE<br><span class="hljs-comment">#或者分两步实现</span><br><span class="hljs-attribute">name</span>=VALUE<br><span class="hljs-built_in">export</span> name<br></code></pre></td></tr></table></figure><p><strong>变量引用：</strong></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$name</span></span><br><span class="hljs-symbol">$</span>&#123;name&#125;<br></code></pre></td></tr></table></figure><p><strong>显示所有环境变量：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">env</span><br><span class="hljs-built_in">printenv</span><br><span class="hljs-built_in">export</span><br><span class="hljs-built_in">declare</span> -x<br></code></pre></td></tr></table></figure><p><strong>查看指定进程的环境变量</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/<span class="hljs-variable">$PID</span>/environ<br></code></pre></td></tr></table></figure><p><strong>删除变量</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">unset</span> name<br></code></pre></td></tr></table></figure><p><strong>bash内建的环境变量</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">PATH<br>SHELL<br><span class="hljs-keyword">USER</span><br><span class="hljs-title">UID</span><br>HOME<br>PWD<br>SHLVL <span class="hljs-comment">#shell的嵌套层数，即深度</span><br>LANG<br>MAIL<br>HOSTNAME<br>HISTSIZE<br>_ <span class="hljs-comment">#下划线,表示前一命令的最后一个参数</span><br></code></pre></td></tr></table></figure><p><strong>扩展：pstree -p</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu200404:/data/scripts# pstree -p<br>systemd(1)─┬─VGAuthService(757)<br>           ├─accounts-daemon(811)─┬─&#123;accounts-daemon&#125;(818)<br>           │                      └─&#123;accounts-daemon&#125;(864)<br>           ├─atd(837)<br>           ├─cron(815)<br>           ├─dbus-daemon(817)<br>           ├─irqbalance(824)───&#123;irqbalance&#125;(853)<br>           ├─login(1206)───bash(1402)───sudo(1413)───bash(1420)<br>           ├─multipathd(702)─┬─&#123;multipathd&#125;(703)<br>           │                 ├─&#123;multipathd&#125;(704)<br>           │                 ├─&#123;multipathd&#125;(705)<br>           │                 ├─&#123;multipathd&#125;(706)<br>           │                 ├─&#123;multipathd&#125;(707)<br>           │                 └─&#123;multipathd&#125;(708)<br>           ├─networkd-dispat(825)<br>           ├─polkitd(872)─┬─&#123;polkitd&#125;(875)<br>           │              └─&#123;polkitd&#125;(877)<br>           ├─rsyslogd(826)─┬─&#123;rsyslogd&#125;(839)<br>           │               ├─&#123;rsyslogd&#125;(840)<br>           │               └─&#123;rsyslogd&#125;(841)<br>           ├─snapd(828)─┬─&#123;snapd&#125;(915)<br>           │            ├─&#123;snapd&#125;(916)<br>           │            ├─&#123;snapd&#125;(917)<br>           │            ├─&#123;snapd&#125;(918)<br>           │            ├─&#123;snapd&#125;(919)<br>           │            ├─&#123;snapd&#125;(945)<br>           │            ├─&#123;snapd&#125;(946)<br>           │            ├─&#123;snapd&#125;(952)<br>           │            ├─&#123;snapd&#125;(954)<br>           │            └─&#123;snapd&#125;(975)<br>           ├─sshd(859)─┬─sshd(3292)───bash(3421)───pstree(13708)<br>           │           └─sshd(6603)───bash(6736)<br>           ├─systemd(1477)───(sd-pam)(1478)<br>           ├─systemd(1392)───(sd-pam)(1393)<br>           ├─systemd-journal(495)<br>           ├─systemd-logind(830)<br>           ├─systemd-network(2826)<br>           ├─systemd-resolve(799)<br>           ├─systemd-timesyn(746)───&#123;systemd-timesyn&#125;(778)<br>           ├─systemd-udevd(525)<br>           ├─udisksd(836)─┬─&#123;udisksd&#125;(863)<br>           │              ├─&#123;udisksd&#125;(866)<br>           │              ├─&#123;udisksd&#125;(883)<br>           │              └─&#123;udisksd&#125;(906)<br>           ├─unattended-upgr(878)───&#123;unattended-upgr&#125;(908)<br>           ├─upowerd(2940)─┬─&#123;upowerd&#125;(2942)<br>           │               └─&#123;upowerd&#125;(2943)<br>           └─vmtoolsd(758)─┬─&#123;vmtoolsd&#125;(781)<br>                           └─&#123;vmtoolsd&#125;(2774)<br></code></pre></td></tr></table></figure><h3 id="2-7-6-只读变量"><a href="#2-7-6-只读变量" class="headerlink" title="2.7.6 只读变量"></a>2.7.6 只读变量</h3><p><strong>只读变量：只能声明定义，但后续不能修改和删除，即常量</strong><br><strong>声明只读变量：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">readonly name<br>declare -r name<br></code></pre></td></tr></table></figure><p><strong>查看只读变量：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">readonly [-p]<br>declare -r<br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># readonly PI=3.14159</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $PI</span><br><span class="hljs-number">3.14159</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># PI=3.14</span><br>-<span class="hljs-symbol">bash:</span> <span class="hljs-symbol">PI:</span> readonly variable<br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h3 id="2-7-7-位置变量"><a href="#2-7-7-位置变量" class="headerlink" title="2.7.7 位置变量"></a>2.7.7 位置变量</h3><p><strong>位置变量：在bash shell中内置的变量, 在脚本代码中调用通过命令行传递给脚本的参数</strong></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$1</span>, $2, ... 对应第1个、第2个等参数，shift [n]换位置</span><br><span class="hljs-meta"><span class="hljs-keyword">$0</span> 命令本身,包括路径</span><br><span class="hljs-symbol">$</span>* 传递给脚本的所有参数，全部参数合为一个字符串<br><span class="hljs-symbol">$</span>@ 传递给脚本的所有参数，每个参数为独立字符串<br><span class="hljs-symbol">$</span># 传递给脚本的参数的个数<br>注意：<span class="hljs-symbol">$</span>@ <span class="hljs-symbol">$</span>* 只在被双引号包起来的时候才会有差异<br></code></pre></td></tr></table></figure><p><strong>清空所有位置变量</strong></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">set</span> <span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1st arg is <span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;2st arg is <span class="hljs-variable">$2</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;3st arg is <span class="hljs-variable">$3</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10st arg is <span class="hljs-variable">$&#123;10&#125;</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;11st arg is <span class="hljs-variable">$&#123;11&#125;</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The number of arg is <span class="hljs-variable">$#</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All args are $*&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All args are <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The scriptname is `basename <span class="hljs-variable">$0</span>`&quot;</span><br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># bash args.sh &#123;a..z&#125;</span><br>1st arg is a<br>2st arg is b<br>3st arg is c<br>10st arg is j<br>11st arg is k<br>The number of arg is 26<br>All args are a b c d e f g h i j k l m n o p q r s t u v w x y z<br>All args are a b c d e f g h i j k l m n o p q r s t u v w x y z<br>The scriptname is args.sh<br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>范例：删库跑路之安全命令</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># 查看命令</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># cat /data/scripts/rm.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#-----------------</span><br><span class="hljs-comment">#删库跑路之安全命令</span><br><span class="hljs-comment">#-----------------</span><br><span class="hljs-comment">#filename:rm.sh</span><br><span class="hljs-comment">#data:2022-08-06</span><br><span class="hljs-comment">#author:admin</span><br><span class="hljs-comment">#-----------------</span><br><br><span class="hljs-variable constant_">WARNING_COLOR</span>=<span class="hljs-string">&quot;echo -e \E[1;31m&quot;</span><br><br><span class="hljs-variable constant_">END</span>=<span class="hljs-string">&quot;\E[0m&quot;</span><br><br><span class="hljs-variable constant_">DIR</span>=<span class="hljs-regexp">/tmp/</span><span class="hljs-string">`date +%F_%H-%M-%S`</span><br><br>mkdir <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DIR</span>&#125;<br><br>mv <span class="hljs-variable">$*</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DIR</span>&#125;<br><br><span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">WARNING_COLOR</span>&#125;Move <span class="hljs-variable">$*</span> to <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">END</span>&#125;<br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br><br><span class="hljs-comment"># 给/data/scripts/rm.sh添加执行权限</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># chmod a+x /data/scripts/rm.sh</span><br><br><span class="hljs-comment"># 添加别名</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment">#alias rm=&#x27;/data/scripts/rm.sh&#x27;</span><br><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># touch &#123;1..9&#125;.TXT</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># rm *.TXT</span><br>Move <span class="hljs-number">1</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">2</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">3</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">4</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">5</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">6</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">7</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">8</span>.<span class="hljs-variable constant_">TXT</span> <span class="hljs-number">9</span>.<span class="hljs-variable constant_">TXT</span> to <br></code></pre></td></tr></table></figure><p>*<em>范例：$<em>和$@的区别</em></em></p><ol><li>当 $* 和 $@ 不带双引号时它们两个是没有区别的，都是接收所有参数然后分别单独处理每个参数！而当$*带双引号的时候，会把接收的所有参数当成一个字段处理</li><li>将$@与$* 赋值给变量之后，结果跟不带引号是一样的！这是我们需要注意的地方，当$* 赋值给变量的时候还是跟不带引号的作用是一样的！</li></ol><h3 id="2-7-8-利用软链接实现同一个脚本不同功能"><a href="#2-7-8-利用软链接实现同一个脚本不同功能" class="headerlink" title="2.7.8  利用软链接实现同一个脚本不同功能"></a>2.7.8 利用软链接实现同一个脚本不同功能</h3><p><strong>范例：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown">[root@centos8 ~]#cat test.sh<br><span class="hljs-section">#!/bin/bash</span><br><span class="hljs-section">#<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span></span><br>echo $0<br>[root@centos8 ~]#ln -s test.sh a.sh<br>[root@centos8 ~]#ln -s test.sh b.sh<br>[root@centos8 ~]#./a.sh<br>./a.sh<br>[root@centos8 ~]#./b.sh<br>./b.sh<br></code></pre></td></tr></table></figure><h3 id="2-7-9-退出状态码变量"><a href="#2-7-9-退出状态码变量" class="headerlink" title="2.7.9 退出状态码变量"></a>2.7.9 退出状态码变量</h3><p><strong>进程执行后，将使用变量 $? 保存状态码的相关数字，不同的值反应成功或失败，$?取值范例 0-255</strong></p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$?</span>的值为<span class="hljs-number">0</span> <span class="hljs-comment">#代表成功</span><br><span class="hljs-variable">$?</span>的值是<span class="hljs-number">1</span>到<span class="hljs-number">255</span> <span class="hljs-comment">#代表失败</span><br></code></pre></td></tr></table></figure><p><strong>范例：状态码为0</strong></p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tap">root@ubuntu200404:/data/scripts<span class="hljs-comment"># ll</span><br>total 40<br>drwxr-xr-x<span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 6 </span>07:29 ./<br>drwxr-xr-x<span class="hljs-number"> 3 </span>root root<span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 6 </span>02:41 ../<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 241 </span>Aug <span class="hljs-number"> 6 </span>06:48 args.sh<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 192 </span>Aug <span class="hljs-number"> 6 </span>02:40 bacup.sh<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 185 </span>Aug <span class="hljs-number"> 6 </span>03:38 demo1.sh<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 85 </span>Aug <span class="hljs-number"> 6 </span>07:26 f1.sh<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 41 </span>Aug <span class="hljs-number"> 6 </span>07:29 file.sh<br>-rwxr-xr-x<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 208 </span>Aug <span class="hljs-number"> 6 </span>01:42 hello.sh*<br>-rwxr-xr-x<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 285 </span>Aug <span class="hljs-number"> 6 </span>07:20 rm.sh*<br>-rwxr-xr-x<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 284 </span>Aug <span class="hljs-number"> 6 </span>07:01 rm.sh.bak*<br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># echo $?</span><br>0<br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>范例：状态码不是0</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># ls ajdksh</span><br><span class="hljs-symbol">ls:</span> cannot access <span class="hljs-string">&#x27;ajdksh&#x27;</span>: <span class="hljs-title class_">No</span> such file <span class="hljs-keyword">or</span> directory<br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $?</span><br><span class="hljs-number">2</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>用户可以在脚本中使用以下命令自定义退出状态码</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span> [n]<br></code></pre></td></tr></table></figure><p><strong>案例：</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">root@ubuntu200404:<span class="hljs-regexp">/data/</span>scripts<span class="hljs-comment"># cat exit.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>echo -e `hostname`<br><br><span class="hljs-keyword">exit</span> <span class="hljs-number">200</span><br><br>echo -e <span class="hljs-string">&#x27;success&#x27;</span><br>root@ubuntu200404:<span class="hljs-regexp">/data/</span>scripts<span class="hljs-comment"># </span><br>root@ubuntu200404:<span class="hljs-regexp">/data/</span>scripts<span class="hljs-comment"># bash exit.sh </span><br>ubuntu200404<br><span class="hljs-keyword">exit</span>.sh: line <span class="hljs-number">4</span>: <span class="hljs-keyword">exit</span>: <span class="hljs-number">200</span>: numeric argument required<br>root@ubuntu200404:<span class="hljs-regexp">/data/</span>scripts<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>注意：</strong></p><ul><li>脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命令后面的数字</li><li>如果exit后面无数字,终止退出状态取决于exit命令前面命令执行结果</li><li>如果没有exit命令, 即未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后一条命令的状态码</li></ul><h3 id="2-7-10-脚本安全和-set"><a href="#2-7-10-脚本安全和-set" class="headerlink" title="2.7.10 脚本安全和 set"></a>2.7.10 脚本安全和 set</h3><p><strong>set 命令：可以用来定制 shell 环境</strong><br>$- 变量<br>h：hashall，打开选项后，Shell 会将命令所在的路径hash下来，避免每次都要查询。通过set +h将h选<br>项关闭<br>i：interactive-comments，包含这个选项说明当前的 shell 是一个交互式的 shell。所谓的交互式shell,<br>在脚本中，i选项是关闭的<br>m：monitor，打开监控模式，就可以通过Job control来控制进程的停止、继续，后台或者前台执行等<br>B：braceexpand，大括号扩展<br>H：history，H选项打开，可以展开历史列表中的命令，可以通过!感叹号来完成，例如“!!”返回上最近的<br>一个历史命令，“!n”返回第 n 个历史命令</p><p><strong>set 命令实现脚本安全</strong><br>-u 在扩展一个没有设置的变量时，显示错误信息， 等同set -o nounset<br>-e 如果一个命令返回一个非0退出状态值(失败)就退出， 等同set -o errexit<br>-o option 显示，打开或者关闭选项<br>显示选项：set -o<br>打开选项：set -o 选项<br>关闭选项：set +o 选项<br>-x 当执行命令时，打印命令及其参数,类似 bash -x<br>范例：-e -u</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#******************</span><br><span class="hljs-comment">#filename:hello.sh</span><br><span class="hljs-comment">#Data:2022-08-06</span><br><span class="hljs-comment">#author:admin</span><br><span class="hljs-comment">#******************</span><br><br><br><span class="hljs-built_in">set</span> -e -u<br><br><span class="hljs-comment">#echo &quot;经典写法&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello world!&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;******************&#x27;</span><br><br><span class="hljs-comment"># 流行写法</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;hello world!&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="2-8-算术运算"><a href="#2-8-算术运算" class="headerlink" title="2.8 算术运算"></a>2.8 算术运算</h2><p>Shell允许在某些情况下对算术表达式进行求值，比如：let和declare 内置命令，(( ))复合命令和算术扩<br>展。求值以固定宽度的整数进行，不检查溢出，尽管除以0 被困并标记为错误。运算符及其优先级，关联性和值与C语言相同。以下运算符列表分组为等优先级运算符级别。级别按降序排列优先。<br><strong>注意：bash 只支持整数，不支持小数</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">+ - addition, subtraction<br><span class="hljs-bullet">* </span>/ % multiplication, division, remainder, %表示取模，即取余数，示例：9%4=1，5%3=2<br>i++ i-- variable post-increment and post-decrement<br>++i --i variable pre-increment and pre-decrement<br><span class="hljs-section">= *= /= %= += -= &lt;&lt;= &gt;&gt;= &amp;= ^= |= assignment</span><br><span class="hljs-bullet">- </span>+ unary minus and plus<br>! ~ logical and bitwise negation<br><span class="hljs-bullet">** </span>exponentiation 乘方,即指数运算<br>&lt;&lt; &gt;&gt; left and right bitwise shifts<br>&lt;= &gt;= &lt; &gt; comparison<br><span class="hljs-section">== != equality and inequality</span><br>&amp; bitwise AND<br>| bitwise OR<br>^ bitwise exclusive OR<br>&amp;&amp; logical AND<br>|| logical OR<br>expr?expr:expr conditional operator<br>expr1 , expr2 comma<br></code></pre></td></tr></table></figure><p><strong>乘法符号有些场景中需要转义</strong><br><strong>实现算术运算：</strong></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-comment">(1)</span> let var=算术表达式<br><span class="hljs-comment">(2)</span> <span class="hljs-comment">((var=算术表达式)</span>) 和上面等价<br><span class="hljs-comment">(3)</span> var=$[算术表达式]<br><span class="hljs-comment">(4)</span> var=$<span class="hljs-comment">((算术表达式)</span>)<br><span class="hljs-comment">(5)</span> var=$<span class="hljs-comment">(expr arg1 arg2 arg3 ...)</span><br><span class="hljs-comment">(6)</span> declare -i var = 数值<br><span class="hljs-comment">(7)</span> echo <span class="hljs-string">&#x27;算术表达式&#x27;</span> | bc<br></code></pre></td></tr></table></figure><p><strong>内建的随机数生成器变量：</strong></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$RANDOM</span> 取值范围：0-32767</span><br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#生成 0 - 49 之间随机数</span><br>echo $[$RANDOM%<span class="hljs-number">50</span>]<br><span class="hljs-meta">#随机字体颜色</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#echo -e <span class="hljs-string">&quot;\033[1;$[RANDOM%7+31]mhello\033[0m&quot;</span></span><br>magedu<br></code></pre></td></tr></table></figure><h2 id="2-9-逻辑运算"><a href="#2-9-逻辑运算" class="headerlink" title="2.9 逻辑运算"></a>2.9 逻辑运算</h2><p><img src="/../image.assets/1659774970166.png" srcset="/img/loading.gif" lazyload alt="1659774970166"></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-number">1</span>,真<br><span class="hljs-number">0</span>,假<br><span class="hljs-meta">#注意,以上为二进制</span><br></code></pre></td></tr></table></figure><p><strong>与或非符号：&amp; | ！</strong></p><p><strong>异或：^</strong></p><p>**异或：^ **<br>异或的两个值，相同为假，不同为真。两个数字X,Y异或得到结果Z，Z再和任意两者之一X异或，将得出另一个值Y</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span>^ <span class="hljs-number">0</span> = <span class="hljs-number">0</span><br><span class="hljs-symbol">0 </span>^ <span class="hljs-number">1</span> = <span class="hljs-number">1</span><br><span class="hljs-symbol">1 </span>^ <span class="hljs-number">0</span> = <span class="hljs-number">1</span><br><span class="hljs-symbol">1 </span>^ <span class="hljs-number">1</span> = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="2-10-条件测试命令"><a href="#2-10-条件测试命令" class="headerlink" title="2.10 条件测试命令"></a>2.10 条件测试命令</h2><p>条件测试：判断某需求是否满足，需要由测试机制来实现，专用的测试表达式需要由测试命令辅助完成<br>测试过程，实现评估布尔声明，以便用在条件性环境下进行执行<br>若真，则状态码变量 $? 返回0<br>若假，则状态码变量 $? 返回1<br>条件测试命令</p><ul><li>test EXPRESSIO</li><li>[ EXPRESSION ] #和test 等价，建议使用 [ ]</li><li>[[ EXPRESSION ]] 相关于增强版的 [ ], 支持[]的用法,且支持扩展正则表达式和通配</li></ul><p><strong>注意：EXPRESSION前后必须有空白字符</strong></p><p><strong>帮助：</strong></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs applescript">root@ubuntu200404:/data/scripts<span class="hljs-comment"># type [</span><br>[ <span class="hljs-keyword">is</span> a shell builtin<br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># </span><br><br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># help test</span><br>test: test [expr]<br>    Evaluate conditional expression.<br>    <br>    Exits <span class="hljs-keyword">with</span> a status <span class="hljs-keyword">of</span> <span class="hljs-number">0</span> (<span class="hljs-literal">true</span>) <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> (<span class="hljs-literal">false</span>) depending <span class="hljs-keyword">on</span><br>    <span class="hljs-keyword">the</span> evaluation <span class="hljs-keyword">of</span> EXPR.  Expressions may be unary <span class="hljs-keyword">or</span> binary.  Unary<br>    expressions are often used <span class="hljs-keyword">to</span> examine <span class="hljs-keyword">the</span> status <span class="hljs-keyword">of</span> a <span class="hljs-built_in">file</span>.  There<br>    are <span class="hljs-built_in">string</span> operators <span class="hljs-keyword">and</span> numeric comparison operators <span class="hljs-keyword">as</span> well.<br>    <br>    The behavior <span class="hljs-keyword">of</span> test depends <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> arguments.  Read <span class="hljs-keyword">the</span><br>    bash manual page <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> complete specification.<br>    <br>    File operators:<br>    <br>      -a FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> exists.<br>      -b FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> block special.<br>      -c FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">character</span> special.<br>      -d FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> a directory.<br>      -e FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> exists.<br>      -f FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> exists <span class="hljs-keyword">and</span> <span class="hljs-keyword">is</span> a regular <span class="hljs-built_in">file</span>.<br>      -g FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>-group-<span class="hljs-built_in">id</span>.<br>      -h FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> a symbolic link.<br>      -L FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> a symbolic link.<br>      -k FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> has <span class="hljs-keyword">its</span> `sticky&#x27; bit <span class="hljs-keyword">set</span>.<br>      -p FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> a named pipe.<br>      -r FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> readable <span class="hljs-keyword">by</span> you.<br>      -s FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> exists <span class="hljs-keyword">and</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> empty.<br>      -S FILE        True <span class="hljs-keyword">if</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> a socket.<br>      -t FD          True <span class="hljs-keyword">if</span> FD <span class="hljs-keyword">is</span> opened <span class="hljs-keyword">on</span> a terminal.<br>      -u FILE        True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>-user-<span class="hljs-built_in">id</span>.<br>      -w FILE        True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> writable <span class="hljs-keyword">by</span> you.<br>      -x FILE        True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> executable <span class="hljs-keyword">by</span> you.<br>      -O FILE        True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> effectively owned <span class="hljs-keyword">by</span> you.<br>      -G FILE        True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> effectively owned <span class="hljs-keyword">by</span> your group.<br>      -N FILE        True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> has been modified <span class="hljs-keyword">since</span> <span class="hljs-keyword">it</span> was <span class="hljs-keyword">last</span> <span class="hljs-built_in">read</span>.<br>    <br>      FILE1 -nt FILE2  True <span class="hljs-keyword">if</span> file1 <span class="hljs-keyword">is</span> newer than file2 (according <span class="hljs-keyword">to</span><br>                       modification <span class="hljs-built_in">date</span>).<br>    <br>      FILE1 -ot FILE2  True <span class="hljs-keyword">if</span> file1 <span class="hljs-keyword">is</span> older than file2.<br>    <br>      FILE1 -ef FILE2  True <span class="hljs-keyword">if</span> file1 <span class="hljs-keyword">is</span> a hard link <span class="hljs-keyword">to</span> file2.<br>    <br>    All <span class="hljs-built_in">file</span> operators except -h <span class="hljs-keyword">and</span> -L are acting <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> target <span class="hljs-keyword">of</span> a symbolic<br>    link, <span class="hljs-keyword">not</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> symlink itself, <span class="hljs-keyword">if</span> FILE <span class="hljs-keyword">is</span> a symbolic link.<br>    <br>    String operators:<br>    <br>      -z STRING      True <span class="hljs-keyword">if</span> <span class="hljs-built_in">string</span> <span class="hljs-keyword">is</span> empty.<br>    <br>      -n STRING<br>         STRING      True <span class="hljs-keyword">if</span> <span class="hljs-built_in">string</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> empty.<br>    <br>      STRING1 = STRING2<br>                     True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> strings are <span class="hljs-keyword">equal</span>.<br>      STRING1 != STRING2<br>                     True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> strings are <span class="hljs-keyword">not</span> <span class="hljs-keyword">equal</span>.<br>      STRING1 &lt; STRING2<br>                     True <span class="hljs-keyword">if</span> STRING1 sorts <span class="hljs-keyword">before</span> STRING2 lexicographically.<br>      STRING1 &gt; STRING2<br>                     True <span class="hljs-keyword">if</span> STRING1 sorts <span class="hljs-keyword">after</span> STRING2 lexicographically.<br>    <br>    Other operators:<br>    <br>      -o OPTION      True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> shell option OPTION <span class="hljs-keyword">is</span> enabled.<br>      -v VAR         True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> shell variable VAR <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br>      -R VAR         True <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> shell variable VAR <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">is</span> a <span class="hljs-built_in">name</span><br>                     <span class="hljs-keyword">reference</span>.<br>      ! EXPR         True <span class="hljs-keyword">if</span> expr <span class="hljs-keyword">is</span> <span class="hljs-literal">false</span>.<br>      EXPR1 -a EXPR2 True <span class="hljs-keyword">if</span> both expr1 AND expr2 are <span class="hljs-literal">true</span>.<br>      EXPR1 -o EXPR2 True <span class="hljs-keyword">if</span> either expr1 OR expr2 <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span>.<br>    <br>      arg1 OP arg2   Arithmetic tests.  OP <span class="hljs-keyword">is</span> one <span class="hljs-keyword">of</span> -eq, -ne,<br>                     -lt, -le, -gt, <span class="hljs-keyword">or</span> -ge.<br>    <br>    Arithmetic binary operators <span class="hljs-literal">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> ARG1 <span class="hljs-keyword">is</span> <span class="hljs-keyword">equal</span>, <span class="hljs-keyword">not</span>-<span class="hljs-keyword">equal</span>,<br>    less-than, less-than-<span class="hljs-keyword">or</span>-<span class="hljs-keyword">equal</span>, greater-than, <span class="hljs-keyword">or</span> greater-than-<span class="hljs-keyword">or</span>-<span class="hljs-keyword">equal</span><br>    than ARG2.<br>    <br>    See <span class="hljs-keyword">the</span> bash manual page bash(<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> handling <span class="hljs-keyword">of</span> parameters (i.e.<br>    missing parameters).<br>    <br>    Exit Status:<br>    Returns success <span class="hljs-keyword">if</span> EXPR evaluates <span class="hljs-keyword">to</span> <span class="hljs-literal">true</span>; fails <span class="hljs-keyword">if</span> EXPR evaluates <span class="hljs-keyword">to</span><br>    <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> an invalid argument <span class="hljs-keyword">is</span> <span class="hljs-keyword">given</span>.<br>root@ubuntu200404:/data/scripts<span class="hljs-comment"># </span><br><br></code></pre></td></tr></table></figure><h3 id="2-10-1-变量测试"><a href="#2-10-1-变量测试" class="headerlink" title="2.10.1 变量测试"></a>2.10.1 变量测试</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs delphi">#判断 <span class="hljs-keyword">NAME</span> 变量是否定义<br>[ -v <span class="hljs-keyword">NAME</span> ]<br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># NAME=&#x27;tom&#x27;</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># [ -v NAME ]</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $?</span><br><span class="hljs-number">0</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># [ -v AGE ]</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $?</span><br><span class="hljs-number">1</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h3 id="2-10-2-数值测试"><a href="#2-10-2-数值测试" class="headerlink" title="2.10.2 数值测试"></a>2.10.2 数值测试</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-eq 是否等于</span><br><span class="hljs-deletion">-ne 是否不等于</span><br><span class="hljs-deletion">-gt 是否大于</span><br><span class="hljs-deletion">-ge 是否大于等于</span><br><span class="hljs-deletion">-lt 是否小于</span><br><span class="hljs-deletion">-le 是否小于等于</span><br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@centos8 ~]#i=10<br>[root@centos8 ~]#j=8<br>[root@centos8 ~]#[ $i -lt $j ]<br>[root@centos8 ~]#echo $?<br>1<br></code></pre></td></tr></table></figure><h3 id="2-10-3-算术表达式比较"><a href="#2-10-3-算术表达式比较" class="headerlink" title="2.10.3 算术表达式比较"></a>2.10.3 算术表达式比较</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">== 相等</span><br>!= 不相等<br>&lt;=<br>&gt;=<br>&lt;<br>&gt;<br></code></pre></td></tr></table></figure><p>范例：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gcode">[root@ce<span class="hljs-symbol">ntos8</span> ~]<span class="hljs-attr">#x=10</span>;y=<span class="hljs-number">10</span>;<span class="hljs-comment">(( x == y )</span>);echo $?<br><span class="hljs-number">0</span><br>[root@ce<span class="hljs-symbol">ntos8</span> ~]<span class="hljs-attr">#x=10</span>;y=<span class="hljs-number">20</span>;<span class="hljs-comment">(( x == y )</span>);echo $?<br><span class="hljs-number">1</span><br>[root@ce<span class="hljs-symbol">ntos8</span> ~]<span class="hljs-attr">#x=10</span>;y=<span class="hljs-number">20</span>;<span class="hljs-comment">(( x != y )</span>);echo $?<br><span class="hljs-number">0</span><br>[root@ce<span class="hljs-symbol">ntos8</span> ~]<span class="hljs-attr">#x=10</span>;y=<span class="hljs-number">10</span>;<span class="hljs-comment">(( x != y )</span>);echo $?<br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="2-10-4-字符窜测试"><a href="#2-10-4-字符窜测试" class="headerlink" title="2.10.4 字符窜测试"></a>2.10.4 字符窜测试</h3><p><strong>test和 [ ] 字符串测试用法</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autoit">-z <span class="hljs-built_in">STRING</span> 字符串是否为空，没定义或空为真，不空为假，<br>-n <span class="hljs-built_in">STRING</span> 字符串是否不空，不空为真，空为假<br><span class="hljs-built_in">STRING</span> 同上<br>STRING1 = STRING2 是否等于，注意 = 前后有空格<br>STRING1 != STRING2 是否不等于<br>&gt; ascii码是否大于ascii码<br>&lt; 是否小于<br></code></pre></td></tr></table></figure><p><strong>[[]] 字符串测试用法</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-string">[[ expression ]]</span> 用法<br>== 左侧字符串是否和右侧的PATTERN相同<br>注意:此表达式用于<span class="hljs-string">[[ ]]</span>中，PATTERN为通配符<br>=~ 左侧字符串是否能够被右侧的正则表达式的PATTERN所匹配<br>注意: 此表达式用于<span class="hljs-string">[[ ]]</span>中为扩展的正则表达式<br></code></pre></td></tr></table></figure><p><strong>建议：当使用正则表达式或通配符使用[[ ]]，其它情况一般使用 [ ]</strong></p><hr><p><strong>范例：使用 [ ]</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#unset str</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#[ -z <span class="hljs-string">&quot;$str&quot;</span> ]</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#echo $?</span><br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><strong>范例：在比较字符串时，建议变量放在“ ”中</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#[ <span class="hljs-string">&quot;$NAME&quot;</span> ]</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#NAME=<span class="hljs-string">&quot;I love linux&quot;</span></span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#[ $NAME ]</span><br>-bash: [: love: <span class="hljs-built_in">binary</span> operator expected<br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#[ <span class="hljs-string">&quot;$NAME&quot;</span> ]</span><br>[root<span class="hljs-symbol">@centos8</span> ~]<span class="hljs-meta">#echo $?</span><br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><strong>[[]]中如果不想使用通配符*,只想表达*本身,可以用” “引起来</strong></p><hr><p><em><em>#[[]]中如果不想使用通配符</em>,只想表达*本身,也可以使用转义符*</em></p><h3 id="2-10-5-文件测试"><a href="#2-10-5-文件测试" class="headerlink" title="2.10.5 文件测试"></a>2.10.5 文件测试</h3><p><strong>存在性测试</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-a FILE：同 -e</span><br><span class="hljs-deletion">-e FILE: 文件存在性测试，存在为真，否则为假</span><br><span class="hljs-deletion">-b FILE：是否存在且为块设备文件</span><br><span class="hljs-deletion">-c FILE：是否存在且为字符设备文件</span><br><span class="hljs-deletion">-d FILE：是否存在且为目录文件</span><br><span class="hljs-deletion">-f FILE：是否存在且为普通文件</span><br><span class="hljs-deletion">-h FILE 或 -L FILE：存在且为符号链接文件</span><br><span class="hljs-deletion">-p FILE：是否存在且为命名管道文件</span><br><span class="hljs-deletion">-S FILE：是否存在且为套接字文件</span><br></code></pre></td></tr></table></figure><p><strong>案例：</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># [ -e /data/scripts/rm.sh ]</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $?</span><br><span class="hljs-number">0</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>文件权限测试</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cmake">-r <span class="hljs-keyword">FILE</span>：是否存在且可读<br>-w <span class="hljs-keyword">FILE</span>: 是否存在且可写<br>-x <span class="hljs-keyword">FILE</span>: 是否存在且可执行<br>-u <span class="hljs-keyword">FILE</span>：是否存在且拥有suid权限<br>-g <span class="hljs-keyword">FILE</span>：是否存在且拥有sgid权限<br>-k <span class="hljs-keyword">FILE</span>：是否存在且拥有sticky权限<br></code></pre></td></tr></table></figure><p><strong>注意：最终结果由用户对文件的实际权限决定，而非文件属性决定</strong></p><hr><p><strong>范例:</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># [ -w /data/scripts/rm.sh ]</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $?</span><br><span class="hljs-number">0</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>文件属性测试</strong></p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-literal">-</span>s FILE <span class="hljs-comment">#是否存在且非空</span><br><span class="hljs-literal">-</span>t fd <span class="hljs-comment">#fd 文件描述符是否在某终端已经打开</span><br><span class="hljs-literal">-</span>N FILE <span class="hljs-comment">#文件自从上一次被读取之后是否被修改过</span><br><span class="hljs-literal">-</span>O FILE <span class="hljs-comment">#当前有效用户是否为文件属主</span><br><span class="hljs-literal">-</span>G FILE <span class="hljs-comment">#当前有效用户是否为文件属组</span><br>FILE1 -ef FILE2 <span class="hljs-comment">#FILE1是否是FILE2的硬链接</span><br>FILE1 -nt FILE2 <span class="hljs-comment">#FILE1是否新于FILE2（mtime）</span><br>FILE1 -ot FILE2 <span class="hljs-comment">#FILE1是否旧于FILE2</span><br></code></pre></td></tr></table></figure><p><strong>案例：</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># [ -s /data/scripts/rm.sh ]</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># echo $?</span><br><span class="hljs-number">0</span><br>root<span class="hljs-variable">@ubuntu200404</span><span class="hljs-symbol">:/data/scripts</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h2 id="2-11-关于（）和"><a href="#2-11-关于（）和" class="headerlink" title="2.11 关于（）和{}"></a>2.11 关于（）和{}</h2><p><strong>（CMD1;CMD2;…）和 { CMD1;CMD2;…; } 都可以将多个命令组合在一起，批量执行</strong>**</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs scss">( list ) 会开启子shell,并且list中变量赋值及内部命令执行后,将不再影响后续的环境<br>帮助参看:man bash 搜索(list)<br>&#123; list; &#125; 不会启子shell, 在当前shell中运行,会影响当前shell环境<br>帮助参看:man bash 搜索&#123; list; &#125;<br><br>( list ) 会开启子shell,并且list中变量赋值及内部命令执行后,将不再影响后续的环境<br>帮助参看:man bash 搜索(list)<br>&#123; list; &#125; 不会启子shell, 在当前shell中运行,会影响当前shell环境<br>帮助参看:man bash 搜索&#123; list; &#125;<br><br>#（）会开启子shell<br><span class="hljs-selector-attr">[root@centos8 ~]</span><span class="hljs-selector-id">#echo</span> <span class="hljs-variable">$BASHPID</span><br><span class="hljs-number">1920</span><br><span class="hljs-selector-attr">[root@centos8 ~]</span>#( echo $BASHPID;sleep <span class="hljs-number">100</span>)<br><span class="hljs-number">1979</span><br><span class="hljs-selector-attr">[root@centos8 ~]</span><span class="hljs-selector-id">#pstree</span> -<span class="hljs-selector-tag">p</span><br>├─<span class="hljs-built_in">sshd</span>(<span class="hljs-number">719</span>)───<span class="hljs-built_in">sshd</span>(<span class="hljs-number">1906</span>)───<span class="hljs-built_in">sshd</span>(<span class="hljs-number">1919</span>)─┬─<span class="hljs-built_in">bash</span>(<span class="hljs-number">1920</span>)───<span class="hljs-built_in">bash</span>(<span class="hljs-number">1979</span>)───<span class="hljs-built_in">sleep</span>(<span class="hljs-number">1980</span>)<br>#&#123; &#125; 不会开启子shell<br><span class="hljs-selector-attr">[root@centos8 ~]</span><span class="hljs-selector-id">#echo</span> <span class="hljs-variable">$BASHPID</span><br><span class="hljs-number">1920</span><br></code></pre></td></tr></table></figure><h2 id="2-12-组合测试"><a href="#2-12-组合测试" class="headerlink" title="2.12 组合测试"></a>2.12 组合测试</h2><h3 id="2-12-1-第一种方式"><a href="#2-12-1-第一种方式" class="headerlink" title="2.12.1 第一种方式"></a>2.12.1 第一种方式</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c">[ EXPRESSION1 -a EXPRESSION2 ] <span class="hljs-meta">#并且，EXPRESSION1和EXPRESSION2都是真，结果才为真</span><br>[ EXPRESSION1 -o EXPRESSION2 ] <span class="hljs-meta">#或者，EXPRESSION1和EXPRESSION2只要有一个真，结果就为</span><br>真<br>[ ! EXPRESSION ] <span class="hljs-meta">#取反</span><br></code></pre></td></tr></table></figure><p><strong>说明： -a 和 -o 需要使用测试命令进行，[[ ]] 不支持</strong></p><h3 id="2-12-2-第二种方式"><a href="#2-12-2-第二种方式" class="headerlink" title="2.12.2 第二种方式"></a>2.12.2 第二种方式</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake">COMMAND1 &amp;&amp; COMMAND2 <span class="hljs-comment">#并且，短路与，代表条件性的AND THEN</span><br>如果COMMAND1 成功,将执行COMMAND2,否则,将不执行COMMAND2<br>COMMAND1 || COMMAND2 <span class="hljs-comment">#或者，短路或，代表条件性的OR ELSE</span><br>如果COMMAND1 成功,将不执行COMMAND2,否则,将执行COMMAND2<br>! <span class="hljs-keyword">COMMAND</span> <span class="hljs-comment">#非,取反</span><br></code></pre></td></tr></table></figure><p><strong>如果&amp;&amp; 和 || 混合使用，&amp;&amp; 要在前，|| 放在后</strong></p><hr><p><strong>练习</strong><br>1、编写脚本 argsnum.sh，接受一个文件路径作为参数；如果参数个数小于1，则提示用户“至少应该给一个参数”，并立即退出；如果参数个数不小于1，则显示第一个参数所指向的文件中的空白行数<br>2、编写脚本 hostping.sh，接受一个主机的IPv4地址做为参数，测试是否可连通。如果能ping通，则提示用户“该IP地址可访问”；如果不可ping通，则提示用户“该IP地址不可访问”<br>3、编写脚本 checkdisk.sh，检查磁盘分区空间和inode使用率，如果超过80%，就发广播警告空间将满<br>4、编写脚本 per.sh，判断当前用户对指定参数文件，是否不可读并且不可写<br>5、编写脚本 excute.sh ，判断参数文件是否为sh后缀的普通文件，如果是，添加所有人可执行权限，否则提示用户非脚本文件<br>6、编写脚本 nologin.sh和 login.sh，实现禁止和允许普通用户登录系统</p><h2 id="2-13-使用read命令来接受输入"><a href="#2-13-使用read命令来接受输入" class="headerlink" title="2.13 使用read命令来接受输入"></a>2.13 使用read命令来接受输入</h2><p>使用read来把输入值分配给一个或多个shell变量，read从标准输入中读取值，给每个单词分配一个变量，所有剩余单词都被分配给最后一个变量，如果变量名没有指定，默认标准输入的值赋值给系统内置变量REPLY<br>格式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">read <span class="hljs-selector-attr">[options]</span> <span class="hljs-selector-attr">[name ...]</span><br></code></pre></td></tr></table></figure><p><strong>常用选项：</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TXT">-p 指定要显示的提示<br>-s 静默输入，一般用于密码<br>-n N 指定输入的字符长度N<br>-d &#x27;字符&#x27; 输入结束符<br>-t N TIMEOUT为N秒<br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@rocky</span> ~]<span class="hljs-meta"># read -p <span class="hljs-string">&#x27;请输入任意内容&#x27;</span> NAME</span><br>请输入任意内容yuan<br>[root<span class="hljs-symbol">@rocky</span> ~]<span class="hljs-meta"># echo $&#123;NAME&#125;</span><br>yuan<br>[root<span class="hljs-symbol">@rocky</span> ~]<span class="hljs-meta"># </span><br></code></pre></td></tr></table></figure><h1 id="3-条件选择if"><a href="#3-条件选择if" class="headerlink" title="3  条件选择if"></a>3 条件选择if</h1><p><strong>格式：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> COMMANDS; <span class="hljs-keyword">then</span> COMMANDS; [ <span class="hljs-keyword">elif</span> COMMANDS; <span class="hljs-keyword">then</span> COMMANDS; ]... [ <span class="hljs-keyword">else</span><br>COMMANDS; ] <span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p><strong>单分支：</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> 判断条件;<span class="hljs-attribute">then</span><br>条件为真的分支代码<br>fi<br></code></pre></td></tr></table></figure><p><strong>双分支：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> 判断条件; <span class="hljs-keyword">then</span><br>条件为真的分支代码<br><span class="hljs-keyword">else</span><br>条件为假的分支代码<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p><strong>多分支：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> 判断条件1; <span class="hljs-keyword">then</span><br>条件1为真的分支代码<br><span class="hljs-keyword">elif</span> 判断条件2; <span class="hljs-keyword">then</span><br>条件2为真的分支代码<br><span class="hljs-keyword">elif</span> 判断条件3; <span class="hljs-keyword">then</span><br>条件3为真的分支代码<br>...<br><span class="hljs-keyword">else</span><br>以上条件都为假的分支代码<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="4-循环"><a href="#4-循环" class="headerlink" title="4 循环"></a>4 循环</h1><h2 id="4-1-for循环"><a href="#4-1-for循环" class="headerlink" title="4.1 for循环"></a>4.1 for循环</h2><p><strong>帮助：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span><br></code></pre></td></tr></table></figure><p><strong>格式：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> NAME [<span class="hljs-keyword">in</span> WORDS ... ] ; <span class="hljs-keyword">do</span> COMMANDS; <span class="hljs-keyword">done</span><br><span class="hljs-comment">#方式1</span><br><span class="hljs-keyword">for</span> 变量名 <span class="hljs-keyword">in</span> 列表;<span class="hljs-keyword">do</span><br>循环体<br><span class="hljs-keyword">done</span><br><span class="hljs-comment">#方式2</span><br><span class="hljs-keyword">for</span> 变量名 <span class="hljs-keyword">in</span> 列表<br><span class="hljs-keyword">do</span><br>循环体<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p><strong>执行机制：</strong></p><ul><li>依次将列表中的元素赋值给“变量名”; 每次赋值后即执行一次循环体; 直到列表中的元素耗尽，循环结束</li><li>如果省略 [in WORDS … ] ，此时使用位置参数变量 in “$@”</li></ul><p><strong>for 循环列表生成方式：</strong></p><ul><li>直接给出列表</li><li>整数列表：</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&#123;start..<span class="hljs-keyword">end</span>&#125;<br><span class="hljs-constructor">$(<span class="hljs-params">seq</span> [<span class="hljs-params">start</span> [<span class="hljs-params">step</span>]] <span class="hljs-params">end</span>)</span><br></code></pre></td></tr></table></figure><ul><li>返回列表的命令</li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">$(COMMAND)<br></code></pre></td></tr></table></figure><ul><li>使用glob，如：*.sh*</li><li>*变量引用，如：$@，$*，$#</li></ul><p><strong>范例：计算1+···+100的值</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@centos8 ~]#sum=0;for i in &#123;1..100&#125;;do let sum+=i;done ;echo sum=$sum<br>sum=5050<br>[root@centos8 ~]#seq -s+ 100|bc5050<br>5050<br>[root@centos8 ~]#echo &#123;1..100&#125;|tr &#x27; &#x27; +|bc<br>5050<br>[root@centos8 ~]#seq 100|paste -sd +|bc<br>5050<br></code></pre></td></tr></table></figure><h2 id="4-2-while循环"><a href="#4-2-while循环" class="headerlink" title="4.2 while循环"></a>4.2 while循环</h2><p><strong>格式</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">while COMMANDS; do COMMANDS; done<br>while CONDITION; do<br>循环体<br>done<br></code></pre></td></tr></table></figure><p><strong>扩展:nc命令</strong></p><p>nc命令 全称netcat，用于设置路由器。它能通过 TCP 和 UDP 在网络中读写数据。通过与其他工具结合和重定向，你可以在脚本中以多种方式使用它。使用 netcat 命令所能完成的事情令人惊讶。</p><p><strong>选项</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs TXT">-g&lt;网关&gt; 设置路由器跃程通信网关，最多可设置8个。<br>-G&lt;指向器数目&gt; 设置来源路由指向器，其数值为4的倍数。<br>-h 在线帮助。<br>-i&lt;延迟秒数&gt; 设置时间间隔，以便传送信息及扫描通信端口。<br>-l 使用监听模式，管控传入的资料。<br>-n 直接使用IP地址，而不通过域名服务器。<br>-o&lt;输出文件&gt; 指定文件名称，把往来传输的数据以16进制字码倾倒成该文件保存。<br>-p&lt;通信端口&gt; 设置本地主机使用的通信端口。<br>-r 乱数指定本地与远端主机的通信端口。<br>-s&lt;来源位址&gt; 设置本地主机送出数据包的IP地址。<br>-u 使用UDP传输协议。<br>-v 显示指令执行过程。<br>-w&lt;超时秒数&gt; 设置等待连线的时间。<br>-z 使用0输入/输出模式，只在扫描通信端口时使用。<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">TCP端口扫描</span><br>[root@rocky ~]# nc -zv 192.168.179.129 80<br>Ncat: Version 7.70 ( https://nmap.org/ncat )<br>Ncat: Connected to 192.168.179.129:80.<br>Ncat: 0 bytes sent, 0 bytes received in 0.01 seconds.<br>[root@rocky ~]# <br></code></pre></td></tr></table></figure><p><strong>范例:写一个扫描某个主机端口的状态的脚本</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">变量</span><br>i=1<br><span class="hljs-meta prompt_"># </span><span class="language-bash">主机IP</span><br>host=192.168.179.138<br><span class="hljs-meta prompt_"># </span><span class="language-bash">清空文件内容</span><br>cat /dev/null &gt;port.TXT<br><span class="hljs-meta prompt_"># </span><span class="language-bash">循环端口1-100</span><br>while [ $i -le 100 ];do<br><span class="hljs-meta prompt_">	# </span><span class="language-bash">扫描端口并将信息放入垃圾箱</span><br>    if nc -z $&#123;host&#125; $&#123;i&#125; &amp;&gt; /dev/null;then<br>    # 屏幕打印IP+port,输出重定向到port.TXT<br>        echo $&#123;host&#125;:$&#123;i&#125; | tee -a port.TXT<br>    fi<br>    # i++<br>    let i++<br>done<br></code></pre></td></tr></table></figure><h1 id="5-其他脚本相关工具"><a href="#5-其他脚本相关工具" class="headerlink" title="5 其他脚本相关工具"></a>5 其他脚本相关工具</h1><h2 id="5-1-trap命令"><a href="#5-1-trap命令" class="headerlink" title="5.1 trap命令"></a>5.1 trap命令</h2><p>trap命令可以捕捉信号，修改信号原有的功能，实现自定义功能</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs TXT"># 查看信号trap -l 或者kill -l<br>root@ubuntu200404-1:/data/scripts# kill -l<br> 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP<br> 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1<br>11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM<br>16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP<br>21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ<br>26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR<br>31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3<br>38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8<br>43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13<br>48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12<br>53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7<br>58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2<br>63) SIGRTMAX-1	64) SIGRTMAX	<br>root@ubuntu200404-1:/data/scripts#<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 进程收到系统发出的制定信号后，将执行自定义指令，而不会执原操作</span><br>trap <span class="hljs-string">&#x27;触发指令&#x27;</span> 信号<br><br><span class="hljs-comment"># 忽略信号的操作</span><br>trap <span class="hljs-string">&#x27;&#x27;</span> 信号<br><br><span class="hljs-comment"># 恢复原信号的操作</span><br>trap <span class="hljs-string">&#x27;-&#x27;</span> 信号<br><br><span class="hljs-comment"># 列出自定义的操作</span><br>trap -p<br><br><span class="hljs-comment"># 当脚本退出时，执行finish函数</span><br>trap finish <span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/bin/bash<br><br># 打印press ctrl+c or ctrl+\   replace int quit<br>trap &quot;echo &#x27;press ctrl+c or ctrl+\ &#x27;&quot; 2 3<br><br># 列出 自定义的操作    <br>trap -p<br><br># 循环并打印1-10<br># 打印1-10键盘按ctrl+c打印press ctrl+c or ctrl<br>for ((i=1;i&lt;=10;i++))<br>do<br>	sleep 1<br>	echo $&#123;i&#125;<br>done<br><br># 忽略2 3信号操作<br>trap &#x27;&#x27; 2 3<br><br># 打印出自定义操作<br>trap -p<br><br># 打印11-20<br># 打印11-20的时候键盘按ctrl+c没有任何操作<br>for((i=11;i&lt;=20;i++))<br>do<br>	sleep 1<br>	echo $&#123;i&#125;<br>done<br><br># 恢复原信号操作<br>trap &#x27;-&#x27; int<br><br># 列出信号操作<br>trap -p<br><br># 打印21-30键盘按ctrl+c 退出<br>for((i=21;i&lt;=30;i++))<br>do<br>        sleep 1<br>        echo $&#123;i&#125;<br>done<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/bin/bash<br><br>finsh()&#123;<br>	echo `date +%F-%T`-finsh | tee -a /data/finsh.log<br><br>&#125;<br># 捕捉到退出执行finsh   trap或者exit<br>trap finsh exit<br><br>while true;do<br>	echo running<br>	sleep 1<br>done<br></code></pre></td></tr></table></figure><p><strong>创建临时文件</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TXT"># mktemp testXXXX<br>root@ubuntu200404-1:/data/scripts# mktemp testXXXXXX.log<br>testdnlqM9.log<br>root@ubuntu200404-1:/data/scripts# <br><br># 创建临时目录<br>root@ubuntu200404-1:/data/scripts# mktemp -d testXXX<br>testGio<br>root@ubuntu200404-1:/data/scripts#<br></code></pre></td></tr></table></figure><h2 id="5-2-except实现自动化的非交互操作"><a href="#5-2-except实现自动化的非交互操作" class="headerlink" title="5. 2 except实现自动化的非交互操作"></a>5. 2 except实现自动化的非交互操作</h2><p>expect 是由Don Libes基于 Tcl（ Tool Command Language ）语言开发的，主要应用于自动化交互式<br>操作的场景，借助 expect 处理交互的命令，可以将交互过程如：ssh登录，ftp登录等写在一个脚本<br>上，使之自动化完成。尤其适用于需要对多台服务器执行相同操作的环境中，可以大大提高系统管理人<br>员的工作效率。</p><p><strong>expect语法</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">expect [选项] [ -c cmds ] [ [ -[f|b] ] cmdfile ] [ args ]<br></code></pre></td></tr></table></figure><p><strong>常见选项</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">-c：从命令行执行expect脚本，默认expect是交互地执行的<br>-d：可以调试信息	<br></code></pre></td></tr></table></figure><p><strong>expect中相关命令</strong></p><ul><li>spawn	启动新的进程</li><li>expect 从进程接收字符串</li><li>send 用于向进程发送字符串</li><li>interact 允许用户交互</li><li>exp_continue 匹配多个字符串在执行动作后加此命令</li></ul><p><strong>范例1:自动登录</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs TXT"># 创建文件<br>vim filename<br><br># 脚本内容<br>#!/usr/bin/expect<br><br># 启动新的进程<br>spawn ssh 192.168.179.138<br># 从进程接收字符串<br>expect &#123;<br>	# 匹配到yse/no，输入yes<br>	&quot;yes/no&quot; &#123;send &quot;yes\n&quot;;exp_continue &#125;<br>	&quot;password&quot; &#123; send &quot;123456\n&quot; &#125;<br>&#125;<br># 允许用户交互<br>interact<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TXT"># 添加可执行权限<br>chmod +x filename<br># 执行<br>./filename<br></code></pre></td></tr></table></figure><p><strong>扩展：scp命令</strong></p><p><strong>语法</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">scp 选项 参数<br></code></pre></td></tr></table></figure><p><strong>选项</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs TXT">-1：使用ssh协议版本1；<br>-2：使用ssh协议版本2；<br>-4：使用ipv4；<br>-6：使用ipv6；<br>-B：以批处理模式运行；<br>-C：使用压缩；<br>-F：指定ssh配置文件；<br>-i：identity_file 从指定文件中读取传输时使用的密钥文件（例如亚马逊云pem），此参数直接传递给ssh；<br>-l：指定宽带限制；<br>-o：指定使用的ssh选项；<br>-P：指定远程主机的端口号；<br>-p：保留文件的最后修改时间，最后访问时间和权限模式；<br>-q：不显示复制进度；<br>-r：以递归方式复制。<br></code></pre></td></tr></table></figure><p><strong>实例</strong><br>从远程复制到本地的scp命令与上面的命令雷同，只要将从本地复制到远程的命令后面2个参数互换顺序就行了。</p><p><strong>从远程机器复制文件到本地目录</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">scp root@10.10.10.10:/opt/soft/nginx-0.5.38.tar.gz /opt/soft/<br></code></pre></td></tr></table></figure><p>从10.10.10.10机器上的&#x2F;opt&#x2F;soft&#x2F;的目录中下载nginx-0.5.38.tar.gz 文件到本地&#x2F;opt&#x2F;soft&#x2F;目录中。</p><p><strong>从远程机器复制目录到本地</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">scp -r root@10.10.10.10:/opt/soft/mongodb /opt/soft/<br></code></pre></td></tr></table></figure><p>从10.10.10.10机器上的&#x2F;opt&#x2F;soft&#x2F;中下载mongodb目录到本地的&#x2F;opt&#x2F;soft&#x2F;目录来。</p><p><strong>上传本地文件到远程机器指定目录</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs TXT">scp /opt/soft/nginx-0.5.38.tar.gz root@10.10.10.10:/opt/soft/scptest<br># 指定端口 2222<br>scp -rp -P 2222 /opt/soft/nginx-0.5.38.tar.gz root@10.10.10.10:/opt/soft/scptest<br></code></pre></td></tr></table></figure><p>复制本地&#x2F;opt&#x2F;soft&#x2F;目录下的文件nginx-0.5.38.tar.gz到远程机器10.10.10.10的opt&#x2F;soft&#x2F;scptest目录。</p><p><strong>上传本地目录到远程机器指定目录</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">scp -r /opt/soft/mongodb root@10.10.10.10:/opt/soft/scptest<br></code></pre></td></tr></table></figure><p>上传本地目录&#x2F;opt&#x2F;soft&#x2F;mongodb到远程机器10.10.10.10上&#x2F;opt&#x2F;soft&#x2F;scptest的目录中去。</p><p><strong>范例2:非交互式复制文件</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/usr/bin/expect<br><br># 开启新的进程,复制当前主机下的/root/hello.sh到远程主机<br>spawn scp /root/hello.sh root@192.168.179.129:/root<br><br>expect &#123;<br>	# 匹配到yes/no，输入yes<br>	&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue&#125;<br>	&quot;password&quot; &#123; send &quot;123456\n&quot;&#125;	<br>&#125;<br>expect eof<br></code></pre></td></tr></table></figure><p><strong>范例3:变量</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/usr/bin/expect<br><br># 添加变量<br>set ip 192.168.179.138<br>set user root<br>set passwd 123456<br>set timeout 10<br><br># 启动新的进程<br>spawn ssh $&#123;user&#125;@$&#123;ip&#125;<br><br>expect &#123;<br>	&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue&#125;<br>	&quot;password&quot; &#123; send &quot;$passwd\n&quot; &#125;<br>&#125;<br><br># 允许交互式操作<br>interact<br></code></pre></td></tr></table></figure><p><strong>范例4:位置参数</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/usr/bin/expect<br><br># 添加变量<br>set ip [lindex $argv 0]<br>set user [lindex $argv 1]<br>set passwd [lindex $argv 2]<br>set timeout 10<br><br># 启动新的进程<br>spawn ssh $&#123;user&#125;@$&#123;ip&#125;<br><br>expect &#123;<br>	&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue&#125;<br>	&quot;password&quot; &#123; send &quot;$passwd\n&quot; &#125;<br><br><br>&#125;<br># 允许交互式操作<br>interact<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TXT"># 添加执行权限<br>[root@centos7 ~]# chmmod +x expect3<br># 后面跟三个参数<br>[root@centos7 ~]# ./expect3 192.168.179.138 root 123456<br></code></pre></td></tr></table></figure><p><strong>范例5:执行多个命令</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/usr/bin/expect<br><br># 添加变量<br>set ip [lindex $argv 0]<br>set user [lindex $argv 1]<br>set passwd [lindex $argv 2]<br>set timeout 10<br><br># 启动新的进程<br>spawn ssh $&#123;user&#125;@$&#123;ip&#125;<br><br>expect &#123;<br>	&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue&#125;<br>	&quot;password&quot; &#123; send &quot;$passwd\n&quot; &#125;<br><br>&#125;<br># adduser haha<br>expect &quot;]#&quot; &#123; send &quot;useradd haha\n&quot; &#125;<br># passwd set 123456<br>expect &quot;]#&quot; &#123; send &quot;echo 123456 |passwd --stdin haha\n&quot; &#125;<br># logout<br>send &quot;exit\n&quot;<br>expect eof<br><br>[root@centos7 ~]# ./expect4 192.168.179.141 root 123456<br></code></pre></td></tr></table></figure><p><strong>范例6:shell脚本调用expect</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/bin/bash<br>ip=$1<br>user=$2<br>password=$3<br>expect &lt;&lt;EOF<br>set timeout 20<br># 开启新的进程，登录远程主机<br>spawn ssh $user@$ip<br>expect &#123;<br>&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue &#125;<br>&quot;password&quot; &#123; send &quot;$password\n&quot; &#125;<br>&#125;<br><br># 添加新的用户<br>expect &quot;]#&quot; &#123; send &quot;useradd hehe\n&quot; &#125;<br># 设置新密码<br>expect &quot;]#&quot; &#123; send &quot;echo 123456 |passwd --stdin hehe\n&quot; &#125;<br># logout<br>expect &quot;]#&quot; &#123; send &quot;exit\n&quot; &#125;<br>expect eof<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos7 ~]# bash expect5.sh 192.168.179.141 root 123456<br></code></pre></td></tr></table></figure><p><strong>范例7: shell脚本利用循环调用expect在CentOS和Ubuntu上批量创建用户</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs TXT">NET=10.0.0<br>user=root<br>password=magedu<br>IPLIST=&quot;<br>7<br>18<br>101<br>&quot;<br>for ID in $IPLIST;do<br>ip=$NET.$ID<br>expect &lt;&lt;EOF<br>set timeout 20<br>spawn ssh $user@$ip<br>expect &#123;<br>&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue &#125;<br>&quot;password&quot; &#123; send &quot;$password\n&quot; &#125;<br>&#125;<br>expect &quot;#&quot; &#123; send &quot;useradd test\n&quot; &#125;<br>expect &quot;#&quot; &#123; send &quot;exit\n&quot; &#125;<br>expect eof<br>EOF<br>done<br></code></pre></td></tr></table></figure><h1 id="6-数组"><a href="#6-数组" class="headerlink" title="6 数组"></a>6 数组</h1><h2 id="6-1-数组介绍"><a href="#6-1-数组介绍" class="headerlink" title="6.1 数组介绍"></a>6.1 数组介绍</h2><p>变量：存储单个元素的内存空间<br>数组：存储多个元素的连续的内存空间，相当于多个变量的集合<br>数组名和索引</p><ul><li>索引的编号从0开始，属于数值索引</li><li>索引可支持使用自定义的格式，而不仅是数值格式，即为关联索引，bash 4.0版本之后开始支持</li><li>bash的数组支持稀疏格式（索引不连续）</li></ul><h2 id="6-2-声明数组"><a href="#6-2-声明数组" class="headerlink" title="6.2 声明数组"></a>6.2 声明数组</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#普通数组可以不事先声明,直接使用<br>declare -a ARRAY_NAME<br>#关联数组必须先声明,再使用<br>declare -A ARRAY_NAME<br></code></pre></td></tr></table></figure><p><strong>注:两者不可相互转换</strong></p><h2 id="6-3-数组赋值"><a href="#6-3-数组赋值" class="headerlink" title="6.3 数组赋值"></a>6.3 数组赋值</h2><p>数组元素的赋值<br>**(1) 一次只赋值一个元素 **</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXt">ARRAY_NAME[INDEX]=VALUE<br></code></pre></td></tr></table></figure><p><strong>范例：</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">weekdays[0]=&quot;Sunday&quot;<br>weekdays[4]=&quot;Thursday&quot;<br></code></pre></td></tr></table></figure><p><strong>(2) 一次赋值全部元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">ARRAY_NAME=(&quot;VAL1&quot; &quot;VAL2&quot; &quot;VAL3&quot; ...)<br></code></pre></td></tr></table></figure><p><strong>范例:</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TXT">title=(&quot;ceo&quot; &quot;coo&quot; &quot;cto&quot;)<br>num=(&#123;0..10&#125;)<br>alpha=(&#123;a..g&#125;)<br>file=( *.sh )<br></code></pre></td></tr></table></figure><p><strong>(3)只赋值特定元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">ARRAY_NAME=([0]=&quot;VAL1&quot; [3]=&quot;VAL2&quot; ...)<br></code></pre></td></tr></table></figure><p><strong>(4)交互式赋值元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">read -a ARRAY<br></code></pre></td></tr></table></figure><h2 id="6-4-显示所有数组"><a href="#6-4-显示所有数组" class="headerlink" title="6.4 显示所有数组"></a>6.4 显示所有数组</h2><p><strong>显示所有数组</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">declare -a<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos7 ~]# declare -a<br>declare -a BASH_ARGC=&#x27;()&#x27;<br>declare -a BASH_ARGV=&#x27;()&#x27;<br>declare -a BASH_LINENO=&#x27;()&#x27;<br>declare -a BASH_SOURCE=&#x27;()&#x27;<br>declare -ar BASH_VERSINFO=&#x27;([0]=&quot;4&quot; [1]=&quot;2&quot; [2]=&quot;46&quot; [3]=&quot;2&quot; [4]=&quot;release&quot; [5]=&quot;x86_64-redhat-linux-gnu&quot;)&#x27;<br>declare -a DIRSTACK=&#x27;()&#x27;<br>declare -a FUNCNAME=&#x27;()&#x27;<br>declare -a GROUPS=&#x27;()&#x27;<br>declare -a PIPESTATUS=&#x27;([0]=&quot;0&quot;)&#x27;<br>[root@centos7 ~]# <br><br></code></pre></td></tr></table></figure><h2 id="6-5-引用数组"><a href="#6-5-引用数组" class="headerlink" title="6.5 引用数组"></a>6.5 引用数组</h2><p><strong>引用特定的数组元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">$&#123;ARRAY_NAME[INDEX]&#125;<br>#如果省略[INDEX]表示引用下标为0的元素<br></code></pre></td></tr></table></figure><p><strong>引用所有数组元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">$&#123;ARRAY_NAME[*]&#125;<br>$&#123;ARRAY_NAME[@]&#125;<br></code></pre></td></tr></table></figure><p><strong>数组的长度，即数组的元素的个数</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">$&#123;#ARRAY_NAME[*]&#125;<br>$&#123;#ARRAY_NAME[@]&#125;<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos7 ~]# title[0]=1<br>[root@centos7 ~]# title[1]=1<br>[root@centos7 ~]# title[2]=1<br>[root@centos7 ~]# echo $&#123;#title[*]&#125;<br>3<br>[root@centos7 ~]# <br></code></pre></td></tr></table></figure><p><strong>数组的所有下标</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">$&#123;!ARRAY_NAME[*]&#125;<br>$&#123;!ARRAY_NAME[@]&#125;<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos7 ~]# title[0]=1<br>[root@centos7 ~]# title[1]=1<br>[root@centos7 ~]# title[2]=1<br>[root@centos7 ~]# echo $&#123;!title[*]&#125;<br>0 1 2<br>[root@centos7 ~]# <br></code></pre></td></tr></table></figure><h2 id="6-6-删除数组"><a href="#6-6-删除数组" class="headerlink" title="6.6 删除数组"></a>6.6 删除数组</h2><p><strong>删除数组中的某个元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">unset ARRAY[INDEX]<br></code></pre></td></tr></table></figure><p><strong>删除整个数组</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TXT">unset ARRAY<br></code></pre></td></tr></table></figure><h2 id="6-7-数组数据处理"><a href="#6-7-数组数据处理" class="headerlink" title="6.7 数组数据处理"></a>6.7 数组数据处理</h2><p><strong>数据切片</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs TXT">$&#123;ARRAY[@]:offset:number&#125;<br>$&#123;ARRAY[*]:offset:number&#125;<br>offset #要跳过的元素个数<br>number #要取出的元素个数<br>#取偏移量之后的所有元素<br>&#123;ARRAY[@]:offset&#125;<br>&#123;ARRAY[*]:offset&#125;<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos8 ~]#num=(&#123;0..10&#125;)<br>[root@centos8 ~]#echo $&#123;num[*]:2:3&#125;<br>2 3 4<br>[root@centos8 ~]#echo $&#123;num[*]:6&#125;<br>6 7 8 9 10<br></code></pre></td></tr></table></figure><p><strong>向数组中追加元素</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">ARRAY[$&#123;#ARRAY[*]&#125;]=value<br>ARRAY[$&#123;#ARRAY[@]&#125;]=value<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos8 ~]#num[$&#123;#num[@]&#125;]=11<br>[root@centos8 ~]#echo $&#123;#num[@]&#125;<br>12<br>[root@centos8 ~]#echo $&#123;num[@]&#125;<br>0 1 2 3 4 5 6 7 8 9 10 11<br></code></pre></td></tr></table></figure><p><strong>范例：生成10个随机数保存于数组中，并找出其最大值和最小值</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#!/bin/bash<br>declare -i min max<br>declare -a nums<br>for ((i=0;i&lt;10;i++));do<br>nums[$i]=$RANDOM<br>[ $i -eq 0 ] &amp;&amp; min=$&#123;nums[0]&#125; &amp;&amp; max=$&#123;nums[0]&#125;&amp;&amp; continue<br>[ $&#123;nums[$i]&#125; -gt $max ] &amp;&amp; max=$&#123;nums[$i]&#125; &amp;&amp; continue<br>[ $&#123;nums[$i]&#125; -lt $min ] &amp;&amp; min=$&#123;nums[$i]&#125;<br>done<br>echo &quot;All numbers are $&#123;nums[*]&#125;&quot;<br>echo Max is $max<br>echo Min is $min<br></code></pre></td></tr></table></figure><h1 id="7-字符串处理"><a href="#7-字符串处理" class="headerlink" title="7 字符串处理"></a>7 字符串处理</h1><h2 id="7-1-字符串切片"><a href="#7-1-字符串切片" class="headerlink" title="7.1 字符串切片"></a>7.1 字符串切片</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#返回字符串变量var的字符的长度,一个汉字算一个字符<br>$&#123;#var&#125;<br>#返回字符串变量var中从第offset个字符后（不包括第offset个字符）的字符开始，到最后的部分，<br>offset的取值在0 到 $&#123;#var&#125;-1 之间(bash4.2后，允许为负值)<br>$&#123;var:offset&#125;<br>#返回字符串变量var中从第offset个字符后（不包括第offset个字符）的字符开始，长度为number的部分<br>$&#123;var:offset:number&#125;<br>#取字符串的最右侧几个字符,取字符串的最右侧几个字符, 注意：冒号后必须有一空白字符<br>$&#123;var: -length&#125;<br>#从最左侧跳过offset字符，一直向右取到距离最右侧lengh个字符之前的内容,即:掐头去尾<br>$&#123;var:offset:-length&#125;<br>#先从最右侧向左取到length个字符开始，再向右取到距离最右侧offset个字符之间的内容,注意：-<br>length前空格,并且length必须大于offset<br>$&#123;var: -length:-offset&#125;<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs TXT">[root@centos8 script40]#str=abcdef我你他<br>[root@centos8 script40]#echo $&#123;#str&#125;<br>9<br>[root@centos8 script40]#echo $&#123;str:2&#125;<br>cdef我你他<br>[root@centos8 script40]#echo $&#123;str:2:3&#125;<br>cde<br>[root@centos8 script40]#echo $&#123;str:-3&#125;<br>abcdef我你他<br>[root@centos8 script40]#echo $&#123;str: -3&#125;<br>我你他<br>[root@centos8 script40]#echo $&#123;str:2:-3&#125;<br>cdef<br>[root@centos8 script40]#echo $&#123;str: -2:-3&#125;<br>-bash: -3: substring expression &lt; 0<br>[root@centos8 script40]#echo $&#123;str: -3:-2&#125;<br>我<br>[root@centos8 script40]#echo $&#123;str:-3:-2&#125;<br>abcdef我你他<br>[root@centos8 script40]#echo $&#123;str: -3:-2&#125;<br>我<br>[root@centos8 script40]#echo $&#123;str: -5:-2&#125;<br>ef我<br></code></pre></td></tr></table></figure><h2 id="7-2-基于模式取子串"><a href="#7-2-基于模式取子串" class="headerlink" title="7.2 基于模式取子串"></a>7.2 基于模式取子串</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#其中word可以是指定的任意字符,自左而右，查找var变量所存储的字符串中，第一次出现的word, 删除字<br>符串开头至第一次出现word字符串（含）之间的所有字符,即懒惰模式,以第一个word为界删左留右<br>$&#123;var#*word&#125;<br>#从var变量的值中删除以word开头的部分<br>$&#123;var#word&#125;<br>#同上，贪婪模式，不同的是，删除的是字符串开头至最后一次由word指定的字符之间的所有内容,即贪婪模<br>式,以最后一个word为界删左留右<br>$&#123;var##*word&#125;<br>$&#123;var##word&#125;<br></code></pre></td></tr></table></figure><p><strong>范例</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TXt">[root@centos8 ~]#file=&quot;var/log/messages&quot;<br>[root@centos8 ~]#echo $&#123;file#*/&#125;<br>log/messages<br>[root@centos8 ~]#echo $&#123;file##*/&#125;<br>messages<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#其中word可以是指定的任意字符,功能：自右而左，查找var变量所存储的字符串中，第一次出现的word,<br>删除字符串最后一个字符向左至第一次出现word字符串（含）之间的所有字符,即懒惰模式,以从右向左的第<br>一个word为界删右留左<br>$&#123;var%word*&#125;<br>$&#123;var%word&#125;<br>#同上，只不过删除字符串最右侧的字符向左至最后一次出现word字符之间的所有字符,即贪婪模式,以从右向<br>左的最后一个word为界删右留左<br>$&#123;var%%word*&#125;<br>$&#123;var%%word&#125;<br></code></pre></td></tr></table></figure><h2 id="7-3-查找和替换"><a href="#7-3-查找和替换" class="headerlink" title="7.3 查找和替换"></a>7.3 查找和替换</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs TXT">#查找var所表示的字符串中，第一次被pattern所匹配到的字符串，以substr替换之<br>$&#123;var/pattern/substr&#125;<br>#查找var所表示的字符串中，所有能被pattern所匹配到的字符串，以substr替换之<br>$&#123;var//pattern/substr&#125;<br>#查找var所表示的字符串中，行首被pattern所匹配到的字符串，以substr替换之<br>$&#123;var/#pattern/substr&#125;<br>#查找var所表示的字符串中，行尾被pattern所匹配到的字符串，以substr替换之<br>$&#123;var/%pattern/substr&#125;<br></code></pre></td></tr></table></figure><h2 id="7-4-查找和删除"><a href="#7-4-查找和删除" class="headerlink" title="7.4 查找和删除"></a>7.4 查找和删除</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">删除var表示的字符串中第一次被pattern匹配到的字符串</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;var/pattern&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">删除var表示的字符串中所有被pattern匹配到的字符串</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;var//pattern&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">删除var表示的字符串中所有以pattern为行首匹配到的字符串</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;var/<span class="hljs-comment">#pattern&#125;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">删除var所表示的字符串中所有以pattern为行尾所匹配到的字符串</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;var/%pattern&#125;</span><br></code></pre></td></tr></table></figure><h2 id="7-5-字符大小写转换"><a href="#7-5-字符大小写转换" class="headerlink" title="7.5 字符大小写转换"></a>7.5 字符大小写转换</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TXt">#把var中的所有小写字母转换为大写<br>$&#123;var^^&#125;<br>#把var中的所有大写字母转换为小写<br>$&#123;var,,&#125;<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Linux%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/">#Linux从入门到放弃</a></div></div><div class="license-box my-3"><div class="license-title"><div>shell编程</div><div>https://itshare.work/2022/08/03/shell编程/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>勒马听风</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年8月3日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2022年12月16日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/08/07/Disk/" title="磁盘存储和文件系统管理"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">磁盘存储和文件系统管理</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/08/01/%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E5%92%8C%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/" title="文件查找和打包压缩"><span class="hidden-mobile">文件查找和打包压缩</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",(function(){var i=Object.assign({appId:"hQDROocUhxVs3CipuQjO33sY-gzGzoHsz",appKey:"CHcmi9bz6KRRaChFJVSY14g1",path:"window.location.pathname",placeholder:"请在这里书写你想说的话······",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:"",emojiCDN:null,emojiMaps:null,enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><span>由<a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>强力驱动</span> <i class="iconfont icon-love"></i> <span>主题</span> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <span>©2022 - 2023</span></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访问客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">黔ICP备2022006994号-2 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=http://beian.miit.gov.cn/" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>黔公网安备2022006994号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/caidai.js"></script><script src="/js/love.main.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>